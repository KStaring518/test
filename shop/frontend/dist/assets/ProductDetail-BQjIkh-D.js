import{d as H,r as f,s as z,o as J,c as v,a as t,w as o,b as d,q as K,E as m,f as s,h as c,j as h,i as C,F as V,t as i,g as L,k as O,u as Q,e as r}from"./index-jh95nJwH.js";import{u as X}from"./user-TGyX2SHZ.js";import{b as Y}from"./product-DW7NrKLf.js";import{a as Z}from"./cart-BlZpDTBS.js";import{l as ee}from"./review-DwHL5sf7.js";import{C as se}from"./ChatWidget-CJkmBooK.js";import{_ as te}from"./_plugin-vue_export-helper-BDJoutlP.js";const oe={class:"product-detail-page"},ne={class:"header-content"},ae={class:"user-info"},le={class:"success-actions"},ie={key:1,class:"product-detail"},re={class:"product-image-section"},ue=["src","alt"],de={class:"product-info-section"},ce={class:"subtitle"},ve={class:"price-section"},pe={class:"price"},me={class:"unit"},_e={class:"stock-section"},ge={class:"stock-value"},fe={class:"quantity-section"},ye={class:"action-section"},ke={class:"product-description"},we={class:"product-reviews"},be={key:0,class:"review-stats"},he={class:"stats-item"},Ce={class:"stats-value"},xe={class:"stats-item"},Re={class:"stats-value"},Ie={class:"stats-item"},$e={class:"stats-value"},ze={key:1,class:"loading-reviews"},Ve={key:2},Le={key:1,class:"review-list"},Ne={class:"review-header"},qe={class:"reviewer-name"},Be={class:"review-time"},De={class:"review-content"},Pe={key:2,class:"loading-section"},Se=H({__name:"ProductDetail",setup(Fe){const k=Q(),N=K(),_=X(),a=f(null),w=f(1),y=f(!1),u=f([]),b=f(!1),q=async()=>{try{const n=N.params.id,e=await Y(parseInt(n));a.value=e.data,await B()}catch(n){console.error("加载商品详情失败:",n),m.error("加载商品详情失败")}},B=async()=>{if(a.value){b.value=!0;try{const n=await ee(a.value.id);u.value=n.data||[]}catch{u.value=[]}finally{b.value=!1}}},D=async()=>{if(!_.isLoggedIn()){m.warning("请先登录"),k.push("/login");return}try{await Z({productId:a.value.id,quantity:w.value}),y.value=!0,m.success("已添加到购物车"),setTimeout(()=>{y.value=!1},3e3)}catch(n){console.error("Failed to add to cart:",n),m.error("添加到购物车失败")}},P=()=>{if(!_.isLoggedIn()){m.warning("请先登录"),k.push("/login");return}m.success("跳转到订单确认页面")},S=()=>{_.logout(),m.success("退出成功"),k.push("/login")},F=n=>new Date(n).toLocaleString("zh-CN"),x=z(()=>u.value.length===0?0:u.value.reduce((e,g)=>e+g.rating,0)/u.value.length),M=z(()=>{if(u.value.length===0)return 0;const n=u.value.filter(e=>e.rating>=4).length;return Math.round(n/u.value.length*100)});return J(()=>{q()}),(n,e)=>{const g=d("el-menu-item"),T=d("el-menu"),p=d("el-button"),E=d("el-header"),A=d("el-alert"),R=d("el-col"),U=d("el-input-number"),j=d("el-row"),I=d("el-rate"),$=d("el-skeleton"),W=d("el-empty"),G=d("el-main");return r(),v("div",oe,[t(E,{class:"header"},{default:o(()=>[s("div",ne,[e[12]||(e[12]=s("div",{class:"logo"},[s("h2",null,"零食商城")],-1)),t(T,{mode:"horizontal",router:!0,class:"nav-menu"},{default:o(()=>[t(g,{index:"/"},{default:o(()=>[...e[5]||(e[5]=[c("首页",-1)])]),_:1}),t(g,{index:"/products"},{default:o(()=>[...e[6]||(e[6]=[c("商品列表",-1)])]),_:1}),t(g,{index:"/cart"},{default:o(()=>[...e[7]||(e[7]=[c("购物车",-1)])]),_:1}),t(g,{index:"/orders"},{default:o(()=>[...e[8]||(e[8]=[c("我的订单",-1)])]),_:1})]),_:1}),s("div",ae,[C(_).isLoggedIn()?(r(),v(V,{key:0},[s("span",null,"欢迎，"+i(C(_).user?.nickname||C(_).user?.username),1),t(p,{onClick:e[0]||(e[0]=l=>n.$router.push("/account")),type:"text"},{default:o(()=>[...e[9]||(e[9]=[c("个人中心",-1)])]),_:1}),t(p,{onClick:S,type:"text"},{default:o(()=>[...e[10]||(e[10]=[c("退出",-1)])]),_:1})],64)):(r(),h(p,{key:1,onClick:e[1]||(e[1]=l=>n.$router.push("/login")),type:"primary"},{default:o(()=>[...e[11]||(e[11]=[c("登录",-1)])]),_:1}))])])]),_:1}),t(G,{class:"main-content"},{default:o(()=>[y.value?(r(),h(A,{key:0,title:"已添加到购物车",type:"success",closable:!1,"show-icon":"",class:"success-alert"},{default:o(()=>[s("div",le,[e[15]||(e[15]=s("span",null,"商品已成功添加到购物车",-1)),t(p,{type:"primary",size:"small",onClick:e[2]||(e[2]=l=>n.$router.push("/cart"))},{default:o(()=>[...e[13]||(e[13]=[c(" 查看购物车 ",-1)])]),_:1}),t(p,{size:"small",onClick:e[3]||(e[3]=l=>y.value=!1)},{default:o(()=>[...e[14]||(e[14]=[c(" 继续购物 ",-1)])]),_:1})])]),_:1})):L("",!0),a.value?(r(),v("div",ie,[t(j,{gutter:40},{default:o(()=>[t(R,{span:12},{default:o(()=>[s("div",re,[s("img",{src:a.value.coverImage,alt:a.value.name,class:"product-image"},null,8,ue)])]),_:1}),t(R,{span:12},{default:o(()=>[s("div",de,[s("h1",null,i(a.value.name),1),s("p",ce,i(a.value.subtitle),1),s("div",ve,[s("span",pe,"¥"+i(a.value.price),1),s("span",me,"/ "+i(a.value.unit),1)]),s("div",_e,[e[16]||(e[16]=s("span",{class:"stock-label"},"库存：",-1)),s("span",ge,i(a.value.stock),1)]),s("div",fe,[e[17]||(e[17]=s("span",{class:"quantity-label"},"数量：",-1)),t(U,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),min:1,max:a.value.stock,size:"large"},null,8,["modelValue","max"])]),s("div",ye,[t(p,{type:"primary",size:"large",onClick:D,disabled:a.value.stock===0},{default:o(()=>[...e[18]||(e[18]=[c(" 加入购物车 ",-1)])]),_:1},8,["disabled"]),t(p,{type:"danger",size:"large",onClick:P,disabled:a.value.stock===0},{default:o(()=>[...e[19]||(e[19]=[c(" 立即购买 ",-1)])]),_:1},8,["disabled"])])])]),_:1})]),_:1}),s("div",ke,[e[20]||(e[20]=s("h3",null,"商品描述",-1)),s("p",null,i(a.value.description),1)]),s("div",we,[e[24]||(e[24]=s("h3",null,"商品评价",-1)),u.value.length>0?(r(),v("div",be,[s("div",he,[e[21]||(e[21]=s("span",{class:"stats-label"},"平均评分：",-1)),t(I,{"model-value":x.value,disabled:""},null,8,["model-value"]),s("span",Ce,i(x.value.toFixed(1)),1)]),s("div",xe,[e[22]||(e[22]=s("span",{class:"stats-label"},"评价数量：",-1)),s("span",Re,i(u.value.length)+"条",1)]),s("div",Ie,[e[23]||(e[23]=s("span",{class:"stats-label"},"好评率：",-1)),s("span",$e,i(M.value)+"%",1)])])):L("",!0),b.value?(r(),v("div",ze,[t($,{rows:4,animated:""})])):(r(),v("div",Ve,[u.value.length===0?(r(),h(W,{key:0,description:"暂无评价"})):(r(),v("div",Le,[(r(!0),v(V,null,O(u.value,l=>(r(),v("div",{key:l.id,class:"review-item"},[s("div",Ne,[t(I,{"model-value":l.rating,disabled:""},null,8,["model-value"]),s("span",qe,i(l.isAnonymous?"匿名用户":l.user?.nickname||l.user?.username||"未知用户"),1),s("span",Be,i(F(l.createdAt)),1)]),s("div",De,i(l.content),1)]))),128))]))]))])])):(r(),v("div",Pe,[t($,{rows:10,animated:""})]))]),_:1}),t(se)])}}}),Ge=te(Se,[["__scopeId","data-v-d4040eda"]]);export{Ge as default};
