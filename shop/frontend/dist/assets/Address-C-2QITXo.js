import{d as ae,r as v,l as ne,o as re,c as k,a as l,w as o,b as n,E as c,f as r,h as i,j as _,i as x,F as w,t as m,A as ie,g as h,k as F,x as de,u as ue,e as d}from"./index-jh95nJwH.js";import{u as ce}from"./user-TGyX2SHZ.js";import{g as me,u as pe,c as fe,d as ve,s as _e}from"./address-BFdK1KhT.js";import{_ as ge}from"./_plugin-vue_export-helper-BDJoutlP.js";const ye={class:"address-page"},be={class:"header-content"},ke={class:"user-info"},Ve={class:"address-container"},Ce={class:"page-header"},xe={class:"address-list"},we={class:"address-content"},Ae={class:"address-info"},Ne={class:"receiver-info"},De={class:"name"},$e={class:"phone"},Ue={class:"address-detail"},qe={class:"address-actions"},Be=ae({__name:"Address",setup(he){const j=ue(),V=ce(),A=v([]),p=v(!1),g=v(null),N=v(!1),z=v(),s=ne({receiverName:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1}),L={receiverName:[{required:!0,message:"请输入收货人姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],province:[{required:!0,message:"请选择省份",trigger:"change"}],city:[{required:!0,message:"请选择城市",trigger:"change"}],district:[{required:!0,message:"请选择区县",trigger:"change"}],detail:[{required:!0,message:"请输入详细地址",trigger:"blur"}]},D=v([]),$=v([]),S={北京市:["北京市"],上海市:["上海市"],广东省:["广州市","深圳市","东莞市","佛山市"],江苏省:["南京市","苏州市","无锡市","常州市"],浙江省:["杭州市","宁波市","温州市","嘉兴市"]},T={北京市:["朝阳区","海淀区","东城区","西城区","丰台区"],上海市:["浦东新区","黄浦区","徐汇区","长宁区","静安区"],广州市:["天河区","越秀区","海珠区","荔湾区","白云区"],深圳市:["南山区","福田区","罗湖区","宝安区","龙岗区"],南京市:["鼓楼区","玄武区","秦淮区","建邺区","栖霞区"],杭州市:["西湖区","上城区","下城区","江干区","拱墅区"]},C=async()=>{try{const a=await me();A.value=a.data||[]}catch(a){console.error("加载地址失败:",a),c.error("加载地址失败")}},M=()=>{s.city="",s.district="",D.value=S[s.province]||[]},E=()=>{s.district="",$.value=T[s.city]||[]},I=a=>{g.value=a,Object.assign(s,{receiverName:a.receiverName,phone:a.phone,province:a.province,city:a.city,district:a.district,detail:a.detail,isDefault:a.isDefault}),M(),E(),p.value=!0},O=async()=>{try{await z.value.validate(),N.value=!0,g.value?(await pe({id:g.value.id,receiverName:s.receiverName,phone:s.phone,province:s.province,city:s.city,district:s.district,detail:s.detail,isDefault:s.isDefault}),c.success("地址更新成功")):(await fe(s),c.success("地址添加成功")),p.value=!1,H(),C()}catch(a){console.error("操作失败:",a),c.error("操作失败")}finally{N.value=!1}},P=async a=>{try{await de.confirm("确定要删除这个地址吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ve(a),c.success("地址删除成功"),C()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),c.error("删除失败"))}},G=async a=>{try{await _e(a),c.success("设置默认地址成功"),C()}catch(e){console.error("设置失败:",e),c.error("设置失败")}},H=()=>{g.value=null,Object.assign(s,{receiverName:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1}),D.value=[],$.value=[]},J=()=>{V.logout(),c.success("退出成功"),j.push("/login")};return re(()=>{C()}),(a,e)=>{const y=n("el-menu-item"),K=n("el-menu"),u=n("el-button"),Q=n("el-header"),W=n("el-icon"),X=n("el-tag"),Y=n("el-card"),Z=n("el-empty"),ee=n("el-main"),U=n("el-input"),b=n("el-form-item"),f=n("el-option"),q=n("el-select"),B=n("el-col"),te=n("el-row"),le=n("el-checkbox"),oe=n("el-form"),se=n("el-dialog");return d(),k("div",ye,[l(Q,{class:"header"},{default:o(()=>[r("div",be,[e[19]||(e[19]=r("div",{class:"logo"},[r("h2",null,"零食商城")],-1)),l(K,{mode:"horizontal",router:!0,class:"nav-menu"},{default:o(()=>[l(y,{index:"/"},{default:o(()=>[...e[12]||(e[12]=[i("首页",-1)])]),_:1}),l(y,{index:"/products"},{default:o(()=>[...e[13]||(e[13]=[i("商品列表",-1)])]),_:1}),l(y,{index:"/cart"},{default:o(()=>[...e[14]||(e[14]=[i("购物车",-1)])]),_:1}),l(y,{index:"/orders"},{default:o(()=>[...e[15]||(e[15]=[i("我的订单",-1)])]),_:1}),l(y,{index:"/address"},{default:o(()=>[...e[16]||(e[16]=[i("地址管理",-1)])]),_:1})]),_:1}),r("div",ke,[x(V).isLoggedIn()?(d(),k(w,{key:0},[r("span",null,"欢迎，"+m(x(V).user?.nickname||x(V).user?.username),1),l(u,{onClick:J,type:"text"},{default:o(()=>[...e[17]||(e[17]=[i("退出",-1)])]),_:1})],64)):(d(),_(u,{key:1,onClick:e[0]||(e[0]=t=>a.$router.push("/login")),type:"primary"},{default:o(()=>[...e[18]||(e[18]=[i("登录",-1)])]),_:1}))])])]),_:1}),l(ee,{class:"main-content"},{default:o(()=>[r("div",Ve,[r("div",Ce,[e[21]||(e[21]=r("h2",null,"收货地址管理",-1)),l(u,{type:"primary",onClick:e[1]||(e[1]=t=>p.value=!0)},{default:o(()=>[l(W,null,{default:o(()=>[l(x(ie))]),_:1}),e[20]||(e[20]=i(" 添加新地址 ",-1))]),_:1})]),r("div",xe,[(d(!0),k(w,null,F(A.value,t=>(d(),_(Y,{key:t.id,class:"address-card"},{default:o(()=>[r("div",we,[r("div",Ae,[r("div",Ne,[r("span",De,m(t.receiverName),1),r("span",$e,m(t.phone),1),t.isDefault?(d(),_(X,{key:0,type:"success",size:"small"},{default:o(()=>[...e[22]||(e[22]=[i("默认",-1)])]),_:1})):h("",!0)]),r("div",Ue,m(t.province)+" "+m(t.city)+" "+m(t.district)+" "+m(t.detail),1)]),r("div",qe,[t.isDefault?h("",!0):(d(),_(u,{key:0,type:"primary",size:"small",onClick:R=>G(t.id)},{default:o(()=>[...e[23]||(e[23]=[i(" 设为默认 ",-1)])]),_:2},1032,["onClick"])),l(u,{type:"warning",size:"small",onClick:R=>I(t)},{default:o(()=>[...e[24]||(e[24]=[i(" 编辑 ",-1)])]),_:2},1032,["onClick"]),l(u,{type:"danger",size:"small",onClick:R=>P(t.id)},{default:o(()=>[...e[25]||(e[25]=[i(" 删除 ",-1)])]),_:2},1032,["onClick"])])])]),_:2},1024))),128)),A.value.length===0?(d(),_(Z,{key:0,description:"暂无收货地址"},{default:o(()=>[l(u,{type:"primary",onClick:e[2]||(e[2]=t=>p.value=!0)},{default:o(()=>[...e[26]||(e[26]=[i("添加第一个地址",-1)])]),_:1})]),_:1})):h("",!0)])])]),_:1}),l(se,{modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=t=>p.value=t),title:g.value?"编辑地址":"添加新地址",width:"500px"},{footer:o(()=>[l(u,{onClick:e[10]||(e[10]=t=>p.value=!1)},{default:o(()=>[...e[28]||(e[28]=[i("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:O,loading:N.value},{default:o(()=>[i(m(g.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:o(()=>[l(oe,{ref_key:"addressFormRef",ref:z,model:s,rules:L,"label-width":"100px"},{default:o(()=>[l(b,{label:"收货人",prop:"receiverName"},{default:o(()=>[l(U,{modelValue:s.receiverName,"onUpdate:modelValue":e[3]||(e[3]=t=>s.receiverName=t),placeholder:"请输入收货人姓名"},null,8,["modelValue"])]),_:1}),l(b,{label:"手机号码",prop:"phone"},{default:o(()=>[l(U,{modelValue:s.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>s.phone=t),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),l(b,{label:"所在地区",required:""},{default:o(()=>[l(te,{gutter:10},{default:o(()=>[l(B,{span:8},{default:o(()=>[l(q,{modelValue:s.province,"onUpdate:modelValue":e[5]||(e[5]=t=>s.province=t),placeholder:"省份",onChange:M},{default:o(()=>[l(f,{label:"北京市",value:"北京市"}),l(f,{label:"上海市",value:"上海市"}),l(f,{label:"广东省",value:"广东省"}),l(f,{label:"江苏省",value:"江苏省"}),l(f,{label:"浙江省",value:"浙江省"})]),_:1},8,["modelValue"])]),_:1}),l(B,{span:8},{default:o(()=>[l(q,{modelValue:s.city,"onUpdate:modelValue":e[6]||(e[6]=t=>s.city=t),placeholder:"城市",onChange:E},{default:o(()=>[(d(!0),k(w,null,F(D.value,t=>(d(),_(f,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(B,{span:8},{default:o(()=>[l(q,{modelValue:s.district,"onUpdate:modelValue":e[7]||(e[7]=t=>s.district=t),placeholder:"区县"},{default:o(()=>[(d(!0),k(w,null,F($.value,t=>(d(),_(f,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(b,{label:"详细地址",prop:"detail"},{default:o(()=>[l(U,{modelValue:s.detail,"onUpdate:modelValue":e[8]||(e[8]=t=>s.detail=t),type:"textarea",rows:3,placeholder:"请输入详细地址，如街道、门牌号等"},null,8,["modelValue"])]),_:1}),l(b,null,{default:o(()=>[l(le,{modelValue:s.isDefault,"onUpdate:modelValue":e[9]||(e[9]=t=>s.isDefault=t)},{default:o(()=>[...e[27]||(e[27]=[i("设为默认地址",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Re=ge(Be,[["__scopeId","data-v-a09f628b"]]);export{Re as default};
