import{i as A,u as x,j as U,k as L}from"./admin-DpVAbB1S.js";import{d as j,r as b,l as M,o as S,c as T,a as e,w as o,b as r,f as C,h as p,E as d,e as q}from"./index-jh95nJwH.js";import{_ as z}from"./_plugin-vue_export-helper-BDJoutlP.js";const F={class:"admin-categories"},G=j({__name:"AdminCategories",setup(H){const _=b([]),a=b(null),t=M({name:"",parentId:void 0,sortOrder:0,status:"ENABLED"}),m=async()=>{const{data:n}=await A();_.value=n},y=n=>{console.log("选中节点:",n),a.value=n.id,Object.assign(t,{name:n.name,parentId:n.parentId,sortOrder:n.sortOrder,status:n.status}),console.log("表单更新后:",t)},I=()=>{a.value=null,Object.assign(t,{name:"",parentId:void 0,sortOrder:0,status:"ENABLED"})},w=()=>{if(console.log("新建子分类 - 当前选中ID:",a.value),!a.value){d.warning("请先选择一个分类作为父级");return}const n=a.value;a.value=null,Object.assign(t,{name:"",parentId:n,sortOrder:0,status:"ENABLED"}),console.log("新建子分类 - 表单已重置:",t)},V=async()=>{if(!t.name){d.error("请输入名称");return}if(a.value&&t.parentId===a.value){d.error("父级ID不能与自身相同");return}console.log("保存分类数据:",{currentId:a.value,form:t,isUpdate:!!a.value,willCallCreate:!a.value,willCallUpdate:!!a.value});try{a.value?(console.log("调用updateCategory，ID:",a.value),await x(a.value,t)):(console.log("调用createCategory，数据:",t),await U(t)),d.success("已保存"),await m()}catch(n){console.error("保存分类失败:",n),d.error("保存失败: "+(n.response?.data?.message||n.message))}},E=async()=>{a.value&&(await L(a.value),d.success("已删除"),I(),await m())};return S(m),(n,l)=>{const D=r("el-tree"),f=r("el-card"),v=r("el-col"),i=r("el-input"),u=r("el-form-item"),g=r("el-option"),O=r("el-select"),c=r("el-button"),B=r("el-popconfirm"),N=r("el-form"),k=r("el-row");return q(),T("div",F,[e(k,{gutter:16},{default:o(()=>[e(v,{span:8},{default:o(()=>[e(f,null,{header:o(()=>[...l[4]||(l[4]=[C("div",{class:"card-header"},"分类树",-1)])]),default:o(()=>[e(D,{data:_.value,"node-key":"id",props:{label:"name",children:"children"},"highlight-current":"",onNodeClick:y},null,8,["data"])]),_:1})]),_:1}),e(v,{span:16},{default:o(()=>[e(f,null,{header:o(()=>[...l[5]||(l[5]=[C("div",{class:"card-header"},"分类编辑",-1)])]),default:o(()=>[e(N,{model:t,"label-width":"80px"},{default:o(()=>[e(u,{label:"名称"},{default:o(()=>[e(i,{modelValue:t.name,"onUpdate:modelValue":l[0]||(l[0]=s=>t.name=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"父级ID"},{default:o(()=>[e(i,{modelValue:t.parentId,"onUpdate:modelValue":l[1]||(l[1]=s=>t.parentId=s),modelModifiers:{number:!0},type:"number",placeholder:"留空=顶级，默认选中节点为父级"},null,8,["modelValue"])]),_:1}),e(u,{label:"排序"},{default:o(()=>[e(i,{modelValue:t.sortOrder,"onUpdate:modelValue":l[2]||(l[2]=s=>t.sortOrder=s),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1}),e(u,{label:"状态"},{default:o(()=>[e(O,{modelValue:t.status,"onUpdate:modelValue":l[3]||(l[3]=s=>t.status=s)},{default:o(()=>[e(g,{label:"启用",value:"ENABLED"}),e(g,{label:"禁用",value:"DISABLED"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(c,{type:"primary",onClick:V},{default:o(()=>[...l[6]||(l[6]=[p("保存",-1)])]),_:1}),e(B,{title:"确认删除该分类？",onConfirm:E},{reference:o(()=>[e(c,{type:"danger"},{default:o(()=>[...l[7]||(l[7]=[p("删除",-1)])]),_:1})]),_:1}),e(c,{onClick:w},{default:o(()=>[...l[8]||(l[8]=[p("新建子类",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}}),Q=z(G,[["__scopeId","data-v-680097db"]]);export{Q as default};
