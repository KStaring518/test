import{d as A,r as C,o as D,c as p,a as r,w as t,b as a,u as H,e as l,f as s,g as k,h as u,i as c,F as g,j as m,t as _,k as h,E as R}from"./index-jh95nJwH.js";import{u as F}from"./user-TGyX2SHZ.js";import{g as q,a as W}from"./product-DW7NrKLf.js";import{n as G}from"./upload-CBboRTXw.js";import{C as J}from"./ChatWidget-CJkmBooK.js";import{_ as K}from"./_plugin-vue_export-helper-BDJoutlP.js";const O={class:"home"},Q={class:"header-content"},X={class:"user-info"},Y=["src","alt"],Z={class:"category-section"},ee={class:"products-section"},te=["src","alt"],oe={class:"product-info"},se={class:"product-subtitle"},ne={class:"product-price"},re=A({__name:"Home",setup(le){const v=H(),i=F(),x=C([]),b=C([]),w=C([]),U=async()=>{try{const d=(await(await fetch("/api/banners/public/list",{headers:{Authorization:localStorage.getItem("token")?`Bearer ${localStorage.getItem("token")}`:""}})).json()).data||[];w.value=d.map(f=>({...f,imageUrl:G(f.imageUrl)}))}catch{}},B=async()=>{try{const n=await q();x.value=n.data||[]}catch(n){console.error("加载分类失败:",n)}},N=async()=>{try{const n=await W({page:1,size:8});b.value=n.data?.list||[]}catch(n){console.error("加载商品失败:",n)}},E=n=>{v.push({path:"/products",query:n?{categoryId:n.toString()}:{}})},j=n=>{v.push(`/product/${n}`)},z=()=>{i.logout(),R.success("退出成功"),v.push("/login")};return D(()=>{i.initUser(),B(),N(),U()}),(n,e)=>{const d=a("el-menu-item"),f=a("el-menu"),y=a("el-button"),L=a("el-header"),M=a("el-carousel-item"),P=a("el-carousel"),I=a("el-card"),$=a("el-col"),S=a("el-row"),T=a("el-main");return l(),p("div",O,[r(L,{class:"header"},{default:t(()=>[s("div",Q,[e[12]||(e[12]=s("div",{class:"logo"},[s("h2",null,"零食商城")],-1)),r(f,{mode:"horizontal",router:!0,class:"nav-menu"},{default:t(()=>[r(d,{index:"/"},{default:t(()=>[...e[2]||(e[2]=[u("首页",-1)])]),_:1}),r(d,{index:"/products"},{default:t(()=>[...e[3]||(e[3]=[u("商品列表",-1)])]),_:1}),c(i).isLoggedIn()?(l(),p(g,{key:0},[r(d,{index:"/cart"},{default:t(()=>[...e[4]||(e[4]=[u("购物车",-1)])]),_:1}),r(d,{index:"/orders"},{default:t(()=>[...e[5]||(e[5]=[u("我的订单",-1)])]),_:1}),c(i).user?.role==="USER"?(l(),m(d,{key:0,index:"/merchant-register"},{default:t(()=>[...e[6]||(e[6]=[u(" 申请成为商家 ",-1)])]),_:1})):k("",!0),c(i).user?.role==="MERCHANT"?(l(),m(d,{key:1,index:"/merchant"},{default:t(()=>[...e[7]||(e[7]=[u(" 商家后台 ",-1)])]),_:1})):k("",!0),c(i).user?.role==="ADMIN"?(l(),m(d,{key:2,index:"/admin"},{default:t(()=>[...e[8]||(e[8]=[u(" 管理后台 ",-1)])]),_:1})):k("",!0)],64)):k("",!0)]),_:1}),s("div",X,[c(i).isLoggedIn()?(l(),p(g,{key:0},[s("span",null,"欢迎，"+_(c(i).user?.nickname||c(i).user?.username),1),r(y,{onClick:e[0]||(e[0]=o=>n.$router.push("/account")),type:"text"},{default:t(()=>[...e[9]||(e[9]=[u("个人中心",-1)])]),_:1}),r(y,{onClick:z,type:"text"},{default:t(()=>[...e[10]||(e[10]=[u("退出",-1)])]),_:1})],64)):(l(),m(y,{key:1,onClick:e[1]||(e[1]=o=>n.$router.push("/login")),type:"primary"},{default:t(()=>[...e[11]||(e[11]=[u("登录",-1)])]),_:1}))])])]),_:1}),r(T,{class:"main-content"},{default:t(()=>[r(P,{height:"400px",class:"banner"},{default:t(()=>[(l(!0),p(g,null,h(w.value,o=>(l(),m(M,{key:o.id},{default:t(()=>[s("img",{src:o.imageUrl,alt:o.title,class:"banner-image"},null,8,Y)]),_:2},1024))),128))]),_:1}),s("div",Z,[e[13]||(e[13]=s("h3",null,"商品分类",-1)),r(S,{gutter:20},{default:t(()=>[(l(!0),p(g,null,h(x.value,o=>(l(),m($,{span:6,key:o.id},{default:t(()=>[r(I,{class:"category-card",onClick:V=>E(o.id)},{default:t(()=>[s("h4",null,_(o.name),1),s("p",null,_(o.children?.length||0)+" 个子分类",1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),s("div",ee,[e[14]||(e[14]=s("h3",null,"推荐商品",-1)),r(S,{gutter:20},{default:t(()=>[(l(!0),p(g,null,h(b.value,o=>(l(),m($,{span:6,key:o.id},{default:t(()=>[r(I,{class:"product-card",onClick:V=>j(o.id)},{default:t(()=>[s("img",{src:o.coverImage,alt:o.name,class:"product-image"},null,8,te),s("div",oe,[s("h4",null,_(o.name),1),s("p",se,_(o.subtitle),1),s("p",ne,"¥"+_(o.price),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])]),_:1}),r(J)])}}}),pe=K(re,[["__scopeId","data-v-8d3a1890"]]);export{pe as default};
