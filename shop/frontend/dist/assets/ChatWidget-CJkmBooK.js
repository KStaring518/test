import{d as O,r as d,s as R,o as F,c as i,f as s,a as m,b as w,w as p,F as M,k as E,p as W,E as _,y as k,h as f,e as l,j as K,t as S,z as j,g as G}from"./index-jh95nJwH.js";import{u as J}from"./user-TGyX2SHZ.js";import{a as h,_ as P}from"./_plugin-vue_export-helper-BDJoutlP.js";const X=n=>h.post("/chat/send",n),Y=(n,v)=>h.post("/chat/session",null,{params:{userId:n,userType:v}}),Z=n=>h.get(`/chat/history/${n}`),ee=n=>h.delete(`/chat/session/${n}`),te=n=>h.post(`/chat/transfer/${n}`),se=()=>h.get("/chat/quick-questions"),ae={class:"chat-widget"},oe={key:1,class:"chat-window"},ne={class:"chat-header"},le={class:"chat-actions"},ie={key:0,class:"welcome-message"},re={class:"quick-questions"},ce={class:"question-tags"},ue={key:1,class:"message-list"},de={class:"message-avatar"},pe={class:"message-content"},ve={class:"message-text"},me={class:"message-time"},he={key:0,class:"low-confidence"},_e={class:"chat-input"},fe=O({__name:"ChatWidget",setup(n){const v=d(!1),y=d(!1),c=d(""),r=d([]),a=d(""),b=d([]),I=J(),g=d(),x=R(()=>{const t=I.user;return t?.role==="ADMIN"?"ADMIN":t?.role==="MERCHANT"?"MERCHANT":"USER"}),q=async()=>{v.value=!0,a.value||await D(),await Q(),await V()},z=()=>{v.value=!1},B=async()=>{a.value&&await ee(a.value),v.value=!1,r.value=[],a.value=""},D=async()=>{try{const t=I.user?.id||0,e=await Y(t,x.value);a.value=e.data}catch{_.error("åˆ›å»ºä¼šè¯å¤±è´¥")}},Q=async()=>{if(a.value)try{const t=await Z(a.value);r.value=t.data||[],await k(),C()}catch{_.error("åŠ è½½èŠå¤©å†å²å¤±è´¥")}},V=async()=>{try{const t=await se();b.value=t.data||[]}catch{b.value=["å¦‚ä½•æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Ÿ","é€€æ¢è´§æ”¿ç­–æ˜¯ä»€ä¹ˆï¼Ÿ","é…é€æ—¶é—´éœ€è¦å¤šä¹…ï¼Ÿ","æ”¯æŒå“ªäº›æ”¯ä»˜æ–¹å¼ï¼Ÿ"]}},N=async()=>{if(!c.value.trim()||!a.value)return;const t=c.value.trim();c.value="";const e={messageId:Date.now().toString(),content:t,sessionId:a.value,timestamp:new Date().toISOString(),status:"SUCCESS"};r.value.push(e),await k(),C(),y.value=!0;try{const u={message:t,sessionId:a.value,userId:I.user?.id,userType:x.value,context:window.location.pathname},T=(await X(u)).data;r.value.push(T),await k(),C()}catch{_.error("å‘é€æ¶ˆæ¯å¤±è´¥"),r.value.pop()}finally{y.value=!1}},U=t=>{c.value=t,N()},$=async()=>{if(a.value)try{const e=(await te(a.value)).data;r.value.push(e),await k(),C(),_.success("å·²ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœ")}catch{_.error("è½¬äººå·¥å¤±è´¥")}},C=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)},A=t=>new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return F(()=>{}),(t,e)=>{const u=w("el-button"),H=w("el-tag"),T=w("el-alert"),L=w("el-input");return l(),i("div",ae,[v.value?(l(),i("div",oe,[s("div",ne,[e[4]||(e[4]=s("div",{class:"chat-title"},[s("span",null,"æ™ºèƒ½å®¢æœåŠ©æ‰‹")],-1)),s("div",le,[m(u,{type:"text",size:"small",onClick:z},{default:p(()=>[...e[2]||(e[2]=[f(" æœ€å°åŒ– ",-1)])]),_:1}),m(u,{type:"text",size:"small",onClick:B},{default:p(()=>[...e[3]||(e[3]=[f(" å…³é—­ ",-1)])]),_:1})])]),s("div",{class:"chat-content",ref_key:"chatContent",ref:g},[r.value.length===0?(l(),i("div",ie,[e[6]||(e[6]=s("div",{class:"bot-avatar"},"ğŸ¤–",-1)),e[7]||(e[7]=s("div",{class:"welcome-text"},[s("p",null,"æ‚¨å¥½ï¼æˆ‘æ˜¯é›¶é£Ÿå•†åŸçš„æ™ºèƒ½å®¢æœåŠ©æ‰‹"),s("p",null,"å¯ä»¥å¸®æ‚¨è§£ç­”å…³äºå•†å“ã€è®¢å•ã€æ”¯ä»˜ã€é€€æ¢è´§ç­‰é—®é¢˜")],-1)),s("div",re,[e[5]||(e[5]=s("p",{class:"quick-title"},"å¸¸è§é—®é¢˜ï¼š",-1)),s("div",ce,[(l(!0),i(M,null,E(b.value,o=>(l(),K(H,{key:o,class:"question-tag",onClick:ye=>U(o),type:"info",effect:"plain"},{default:p(()=>[f(S(o),1)]),_:2},1032,["onClick"]))),128))])])])):(l(),i("div",ue,[(l(!0),i(M,null,E(r.value,o=>(l(),i("div",{key:o.messageId,class:j(["message",o.isHandledByHuman?"human":"bot"])},[s("div",de,S(o.isHandledByHuman?"ğŸ‘¤":"ğŸ¤–"),1),s("div",pe,[s("div",ve,S(o.content),1),s("div",me,S(A(o.timestamp)),1),o.status==="LOW_CONFIDENCE"?(l(),i("div",he,[m(T,{title:"æˆ‘çš„å›ç­”å¯èƒ½ä¸å¤Ÿå‡†ç¡®",type:"warning",closable:!1,"show-icon":""},{default:p(()=>[m(u,{type:"primary",size:"small",onClick:$},{default:p(()=>[...e[8]||(e[8]=[f(" è½¬äººå·¥å®¢æœ ",-1)])]),_:1})]),_:1})])):G("",!0)])],2))),128))]))],512),s("div",_e,[m(L,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",onKeyup:W(N,["enter"]),disabled:y.value},{append:p(()=>[m(u,{type:"primary",onClick:N,loading:y.value,disabled:!c.value.trim()},{default:p(()=>[...e[9]||(e[9]=[f(" å‘é€ ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","disabled"])])])):(l(),i("div",{key:0,class:"chat-button",onClick:q},[...e[1]||(e[1]=[s("span",null,"æ™ºèƒ½å®¢æœ",-1)])]))])}}}),ke=P(fe,[["__scopeId","data-v-c5e01d86"]]);export{ke as C};
