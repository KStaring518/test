import{d as Y,r as O,l as x,o as Z,c as p,f as s,a,w as o,b as c,F as h,E as C,h as l,j as w,i as D,t as d,g as v,k as A,u as tt,e as i,x as E}from"./index-jh95nJwH.js";import{u as st}from"./user-TGyX2SHZ.js";import{g as et,a as ot,c as at,b as nt}from"./order-3D-lLFhF.js";import{a as rt}from"./upload-CBboRTXw.js";import{C as lt}from"./ChatWidget-CJkmBooK.js";import{_ as dt}from"./_plugin-vue_export-helper-BDJoutlP.js";const it={class:"orders-page"},ut={class:"header-content"},pt={class:"user-info"},ct={class:"orders-container"},mt={style:{"margin-bottom":"16px"}},_t={key:0,class:"order-summary"},vt={class:"summary-item"},yt={class:"summary-number"},gt={class:"summary-item unpaid"},ft={class:"summary-number"},Ct={class:"summary-item paid"},kt={class:"summary-number"},bt={class:"summary-item shipped"},St={class:"summary-number"},It={class:"summary-item finished"},ht={class:"summary-number"},wt={class:"summary-item cancelled"},Dt={class:"summary-number"},zt={class:"orders-list"},Nt={key:0,class:"empty-orders"},Pt={key:1},Ot={class:"order-header"},xt={class:"order-info"},At={class:"order-no"},Et={class:"order-time"},Lt={class:"order-status"},Ut={class:"order-content"},Bt=["src","alt"],$t={class:"product-info"},Ht={key:0},Mt={class:"product-price"},Tt={key:1,class:"review-status"},Vt={class:"order-footer"},Ft={class:"order-address"},Rt={class:"order-total"},jt={class:"order-actions"},qt={key:1,class:"pagination-section"},Gt=Y({__name:"Orders",setup(Wt){const z=tt(),k=st(),b=O([]),m=O(null),S=x({status:"ALL"}),u=x({page:1,size:10,total:0}),y=async()=>{try{const e=await et({page:u.page,size:u.size,status:S.status==="ALL"?void 0:S.status});b.value=e.data.list||[],u.total=e.data.total||0}catch(e){console.error("加载订单失败:",e),C.error("加载订单失败")}},N=async()=>{try{const e=await ot();m.value=e.data}catch(e){console.error("加载订单统计失败:",e)}},L=async e=>{try{await E.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await at(e.id),C.success("确认收货成功"),await y(),await N()}catch(t){t!=="cancel"&&(console.error("确认收货失败:",t),C.error("确认收货失败"))}},U=async e=>{try{await E.confirm("确定要取消这个订单吗？","确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await nt(e.id),C.success("订单已取消"),await y(),await N()}catch(t){t!=="cancel"&&(console.error("取消订单失败:",t),C.error("取消订单失败"))}},B=e=>{z.push(`/order/${e.id}`)},$=e=>{z.push({path:"/payment",query:{orderNo:e.orderNo,totalAmount:String(e.totalAmount)}})},H=e=>{u.size=e,u.page=1,y()},M=e=>{u.page=e,y()},T=()=>{u.page=1,y()},V=e=>new Date(e).toLocaleString("zh-CN"),F=e=>({UNPAID:"warning",PAID:"primary",SHIPPED:"success",FINISHED:"success",CLOSED:"info"})[e]||"info",R=e=>({UNPAID:"待付款",PAID:"待发货",SHIPPED:"待收货",FINISHED:"已完成",CLOSED:"已取消"})[e]||e,j=()=>{k.logout(),C.success("退出成功"),z.push("/login")};return Z(()=>{k.initUser(),y(),N()}),(e,t)=>{const I=c("el-menu-item"),q=c("el-menu"),_=c("el-button"),G=c("el-header"),g=c("el-radio-button"),W=c("el-radio-group"),f=c("el-col"),J=c("el-row"),K=c("el-empty"),P=c("el-tag"),Q=c("el-pagination"),X=c("el-main");return i(),p(h,null,[s("div",it,[a(G,{class:"header"},{default:o(()=>[s("div",ut,[t[11]||(t[11]=s("div",{class:"logo"},[s("h2",null,"零食商城")],-1)),a(q,{mode:"horizontal",router:!0,class:"nav-menu"},{default:o(()=>[a(I,{index:"/"},{default:o(()=>[...t[5]||(t[5]=[l("首页",-1)])]),_:1}),a(I,{index:"/products"},{default:o(()=>[...t[6]||(t[6]=[l("商品列表",-1)])]),_:1}),a(I,{index:"/cart"},{default:o(()=>[...t[7]||(t[7]=[l("购物车",-1)])]),_:1}),a(I,{index:"/orders"},{default:o(()=>[...t[8]||(t[8]=[l("我的订单",-1)])]),_:1})]),_:1}),s("div",pt,[D(k).isLoggedIn()?(i(),p(h,{key:0},[s("span",null,"欢迎，"+d(D(k).user?.nickname||D(k).user?.username),1),a(_,{onClick:j,type:"text"},{default:o(()=>[...t[9]||(t[9]=[l("退出",-1)])]),_:1})],64)):(i(),w(_,{key:1,onClick:t[0]||(t[0]=n=>e.$router.push("/login")),type:"primary"},{default:o(()=>[...t[10]||(t[10]=[l("登录",-1)])]),_:1}))])])]),_:1}),a(X,{class:"main-content"},{default:o(()=>[s("div",ct,[t[29]||(t[29]=s("h2",null,"我的订单",-1)),s("div",mt,[a(W,{modelValue:S.status,"onUpdate:modelValue":t[1]||(t[1]=n=>S.status=n),onChange:T},{default:o(()=>[a(g,{label:"ALL"},{default:o(()=>[...t[12]||(t[12]=[l("全部",-1)])]),_:1}),a(g,{label:"UNPAID"},{default:o(()=>[...t[13]||(t[13]=[l("待付款",-1)])]),_:1}),a(g,{label:"PAID"},{default:o(()=>[...t[14]||(t[14]=[l("待发货",-1)])]),_:1}),a(g,{label:"SHIPPED"},{default:o(()=>[...t[15]||(t[15]=[l("待收货",-1)])]),_:1}),a(g,{label:"FINISHED"},{default:o(()=>[...t[16]||(t[16]=[l("已完成",-1)])]),_:1}),a(g,{label:"CLOSED"},{default:o(()=>[...t[17]||(t[17]=[l("已取消",-1)])]),_:1})]),_:1},8,["modelValue"])]),m.value?(i(),p("div",_t,[a(J,{gutter:20},{default:o(()=>[a(f,{span:4},{default:o(()=>[s("div",vt,[s("div",yt,d(m.value.totalOrders),1),t[18]||(t[18]=s("div",{class:"summary-label"},"全部订单",-1))])]),_:1}),a(f,{span:4},{default:o(()=>[s("div",gt,[s("div",ft,d(m.value.unpaidOrders),1),t[19]||(t[19]=s("div",{class:"summary-label"},"待付款",-1))])]),_:1}),a(f,{span:4},{default:o(()=>[s("div",Ct,[s("div",kt,d(m.value.paidOrders),1),t[20]||(t[20]=s("div",{class:"summary-label"},"待发货",-1))])]),_:1}),a(f,{span:4},{default:o(()=>[s("div",bt,[s("div",St,d(m.value.shippedOrders),1),t[21]||(t[21]=s("div",{class:"summary-label"},"待收货",-1))])]),_:1}),a(f,{span:4},{default:o(()=>[s("div",It,[s("div",ht,d(m.value.finishedOrders),1),t[22]||(t[22]=s("div",{class:"summary-label"},"已完成",-1))])]),_:1}),a(f,{span:4},{default:o(()=>[s("div",wt,[s("div",Dt,d(m.value.cancelledOrders),1),t[23]||(t[23]=s("div",{class:"summary-label"},"已取消",-1))])]),_:1})]),_:1})])):v("",!0),s("div",zt,[b.value.length===0?(i(),p("div",Nt,[a(K,{description:"暂无订单"},{default:o(()=>[a(_,{type:"primary",onClick:t[2]||(t[2]=n=>e.$router.push("/products"))},{default:o(()=>[...t[24]||(t[24]=[l("去购物",-1)])]),_:1})]),_:1})])):(i(),p("div",Pt,[(i(!0),p(h,null,A(b.value,n=>(i(),p("div",{key:n.id,class:"order-item"},[s("div",Ot,[s("div",xt,[s("span",At,"订单号："+d(n.orderNo),1),s("span",Et,d(V(n.createdAt)),1)]),s("div",Lt,[a(P,{type:F(n.status)},{default:o(()=>[l(d(R(n.status)),1)]),_:2},1032,["type"])])]),s("div",Ut,[(i(!0),p(h,null,A(n.orderItems,r=>(i(),p("div",{key:r.id,class:"order-product"},[s("img",{src:r.product&&r.product.coverImage?D(rt)(r.product.coverImage):"/placeholder-product.png",alt:r.product?r.product.name:r.productNameSnapshot,class:"product-image"},null,8,Bt),s("div",$t,[s("h4",null,d(r.product?r.product.name:r.productNameSnapshot),1),r.product&&r.product.subtitle?(i(),p("p",Ht,d(r.product.subtitle),1)):v("",!0),s("p",Mt,"¥"+d(r.priceSnapshot)+" × "+d(r.quantity),1),n.status==="FINISHED"?(i(),p("div",Tt,[a(P,{type:r.hasReview?"success":"warning",size:"small"},{default:o(()=>[l(d(r.hasReview?"已评价":"未评价"),1)]),_:2},1032,["type"])])):v("",!0)])]))),128))]),s("div",Vt,[s("div",Ft,[s("span",null,"收货地址："+d(n.receiverAddress),1)]),s("div",Rt,[s("span",null,"总计：¥"+d(n.totalAmount),1)]),s("div",jt,[n.status==="UNPAID"?(i(),w(_,{key:0,type:"primary",size:"small",onClick:r=>$(n)},{default:o(()=>[...t[25]||(t[25]=[l(" 去支付 ",-1)])]),_:2},1032,["onClick"])):v("",!0),n.status==="SHIPPED"?(i(),w(_,{key:1,type:"success",size:"small",onClick:r=>L(n)},{default:o(()=>[...t[26]||(t[26]=[l(" 确认收货 ",-1)])]),_:2},1032,["onClick"])):v("",!0),n.status==="UNPAID"?(i(),w(_,{key:2,type:"danger",size:"small",onClick:r=>U(n)},{default:o(()=>[...t[27]||(t[27]=[l(" 取消订单 ",-1)])]),_:2},1032,["onClick"])):v("",!0),a(_,{type:"info",size:"small",onClick:r=>B(n)},{default:o(()=>[...t[28]||(t[28]=[l(" 查看详情 ",-1)])]),_:2},1032,["onClick"])])])]))),128))]))]),b.value.length>0?(i(),p("div",qt,[a(Q,{"current-page":u.page,"onUpdate:currentPage":t[3]||(t[3]=n=>u.page=n),"page-size":u.size,"onUpdate:pageSize":t[4]||(t[4]=n=>u.size=n),total:u.total,"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:M},null,8,["current-page","page-size","total"])])):v("",!0)])]),_:1})]),a(lt)],64)}}}),ts=dt(Gt,[["__scopeId","data-v-33a4ba9e"]]);export{ts as default};
