import{u as ae}from"./user-TGyX2SHZ.js";import{a as C,_ as te}from"./_plugin-vue_export-helper-BDJoutlP.js";import{g as oe,u as se,c as ne,s as de,d as re}from"./address-BFdK1KhT.js";import{n as M}from"./upload-CBboRTXw.js";import{d as ie,l as z,r as v,o as ue,c as R,f as d,a as l,w as t,b as i,j as x,g as q,F as me,k as pe,h as p,t as g,E as f,e as V,x as fe}from"./index-jh95nJwH.js";const ce=()=>C.get("/user/profile"),ve=w=>C.put("/user/profile",w),we=(w,_)=>C.put("/user/password",{oldPassword:w,newPassword:_}),_e=w=>{const _=new FormData;return _.append("file",w),C.post("/upload/avatar",_,{headers:{"Content-Type":"multipart/form-data"}})},ye={class:"user-center"},ge={style:{display:"flex","align-items":"center",gap:"12px"}},Ve={style:{"margin-top":"24px"}},ke={class:"address-toolbar"},be={class:"addr-row"},Ue={class:"addr-main"},xe={class:"addr-line"},Ce={class:"name"},Pe={class:"phone"},De={class:"addr-detail"},Ne={class:"addr-actions"},Ae={style:{"margin-top":"24px"}},Se=ie({__name:"UserCenter",setup(w){const _=ae(),n=z({avatarUrl:"",nickname:"",phone:"",email:""}),P=v(!1),u=z({oldPassword:"",newPassword:""}),D=v(!1),N=v([]),y=v(!1),k=v(null),A=v(!1),B=v(),o=z({receiverName:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1}),I={receiverName:[{required:!0,message:"请输入收货人",trigger:"blur"}],phone:[{required:!0,message:"请输入手机",trigger:"blur"}],detail:[{required:!0,message:"请输入详细地址",trigger:"blur"}]},T=async()=>{const{data:s}=await ce();n.avatarUrl=M(s.avatarUrl)||"",n.nickname=s.nickname||"",n.phone=s.phone||"",n.email=s.email||"",await b()},j=async()=>{P.value=!0;try{await ve(n),f.success("保存成功")}finally{P.value=!1}},L=async s=>{try{const e=s.file,{data:U}=await _e(e);n.avatarUrl=M(U),f.success("头像上传成功，记得点保存"),s.onSuccess&&s.onSuccess(U)}catch(e){f.error("头像上传失败"),s.onError&&s.onError(e)}},G=async()=>{if(!u.oldPassword){f.warning("请输入旧密码");return}if(!u.newPassword||u.newPassword.length<6){f.warning("新密码至少6位");return}D.value=!0;try{await we(u.oldPassword,u.newPassword),f.success("密码已更新"),u.oldPassword="",u.newPassword=""}finally{D.value=!1}},b=async()=>{const{data:s}=await oe();N.value=s||[]},H=()=>{k.value=null,o.receiverName="",o.phone="",o.province="",o.city="",o.district="",o.detail="",o.isDefault=!1},J=()=>{H(),y.value=!0},K=s=>{k.value=s,o.receiverName=s.receiverName,o.phone=s.phone,o.province=s.province,o.city=s.city,o.district=s.district,o.detail=s.detail,o.isDefault=s.isDefault,y.value=!0},O=async()=>{await B.value.validate(),A.value=!0;try{k.value?(await se({id:k.value.id,...o}),f.success("已更新")):(await ne(o),f.success("已添加")),y.value=!1,await b()}finally{A.value=!1}},Q=async s=>{await fe.confirm("确定删除该地址吗？","提示"),await re(s),f.success("已删除"),await b()},W=async s=>{await de(s),f.success("已设为默认"),await b()};return ue(()=>{_.initUser(),T()}),(s,e)=>{const U=i("el-avatar"),c=i("el-button"),X=i("el-upload"),r=i("el-form-item"),m=i("el-input"),S=i("el-form"),E=i("el-card"),Y=i("el-tag"),Z=i("el-empty"),F=i("el-col"),h=i("el-row"),ee=i("el-checkbox"),le=i("el-dialog");return V(),R("div",ye,[e[27]||(e[27]=d("h2",null,"个人中心",-1)),l(E,null,{default:t(()=>[l(S,{model:n,"label-width":"90px",style:{"max-width":"520px"}},{default:t(()=>[l(r,{label:"头像"},{default:t(()=>[d("div",ge,[l(U,{size:64,src:n.avatarUrl},null,8,["src"]),l(X,{"show-file-list":!1,"http-request":L,accept:"image/*"},{default:t(()=>[l(c,null,{default:t(()=>[...e[14]||(e[14]=[p("上传头像",-1)])]),_:1})]),_:1})])]),_:1}),l(r,{label:"昵称"},{default:t(()=>[l(m,{modelValue:n.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>n.nickname=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"手机"},{default:t(()=>[l(m,{modelValue:n.phone,"onUpdate:modelValue":e[1]||(e[1]=a=>n.phone=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"邮箱"},{default:t(()=>[l(m,{modelValue:n.email,"onUpdate:modelValue":e[2]||(e[2]=a=>n.email=a)},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(c,{type:"primary",onClick:j,loading:P.value},{default:t(()=>[...e[15]||(e[15]=[p("保存",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),d("div",Ve,[e[21]||(e[21]=d("h3",null,"地址管理",-1)),d("div",ke,[l(c,{type:"primary",onClick:J},{default:t(()=>[...e[16]||(e[16]=[p("添加地址",-1)])]),_:1})]),(V(!0),R(me,null,pe(N.value,a=>(V(),x(E,{key:a.id,class:"addr-card"},{default:t(()=>[d("div",be,[d("div",Ue,[d("div",xe,[d("span",Ce,g(a.receiverName),1),d("span",Pe,g(a.phone),1),a.isDefault?(V(),x(Y,{key:0,type:"success",size:"small"},{default:t(()=>[...e[17]||(e[17]=[p("默认",-1)])]),_:1})):q("",!0)]),d("div",De,g(a.province)+" "+g(a.city)+" "+g(a.district)+" "+g(a.detail),1)]),d("div",Ne,[a.isDefault?q("",!0):(V(),x(c,{key:0,size:"small",onClick:$=>W(a.id)},{default:t(()=>[...e[18]||(e[18]=[p("设为默认",-1)])]),_:2},1032,["onClick"])),l(c,{size:"small",type:"warning",onClick:$=>K(a)},{default:t(()=>[...e[19]||(e[19]=[p("编辑",-1)])]),_:2},1032,["onClick"]),l(c,{size:"small",type:"danger",onClick:$=>Q(a.id)},{default:t(()=>[...e[20]||(e[20]=[p("删除",-1)])]),_:2},1032,["onClick"])])])]),_:2},1024))),128)),N.value.length===0?(V(),x(Z,{key:0,description:"暂无地址"})):q("",!0)]),d("div",Ae,[e[23]||(e[23]=d("h3",null,"修改密码",-1)),l(E,{style:{"max-width":"520px"}},{default:t(()=>[l(S,{model:u,"label-width":"90px"},{default:t(()=>[l(r,{label:"旧密码"},{default:t(()=>[l(m,{modelValue:u.oldPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>u.oldPassword=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(r,{label:"新密码"},{default:t(()=>[l(m,{modelValue:u.newPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>u.newPassword=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(c,{type:"warning",onClick:G,loading:D.value},{default:t(()=>[...e[22]||(e[22]=[p("保存新密码",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),l(le,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value=a),title:k.value?"编辑地址":"新增地址",width:"520px"},{footer:t(()=>[l(c,{onClick:e[12]||(e[12]=a=>y.value=!1)},{default:t(()=>[...e[25]||(e[25]=[p("取消",-1)])]),_:1}),l(c,{type:"primary",loading:A.value,onClick:O},{default:t(()=>[...e[26]||(e[26]=[p("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(S,{ref_key:"addrFormRef",ref:B,model:o,rules:I,"label-width":"90px"},{default:t(()=>[l(r,{label:"收货人",prop:"receiverName"},{default:t(()=>[l(m,{modelValue:o.receiverName,"onUpdate:modelValue":e[5]||(e[5]=a=>o.receiverName=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"手机",prop:"phone"},{default:t(()=>[l(m,{modelValue:o.phone,"onUpdate:modelValue":e[6]||(e[6]=a=>o.phone=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"省市区",required:""},{default:t(()=>[l(h,{gutter:8},{default:t(()=>[l(F,{span:8},{default:t(()=>[l(m,{modelValue:o.province,"onUpdate:modelValue":e[7]||(e[7]=a=>o.province=a),placeholder:"省"},null,8,["modelValue"])]),_:1}),l(F,{span:8},{default:t(()=>[l(m,{modelValue:o.city,"onUpdate:modelValue":e[8]||(e[8]=a=>o.city=a),placeholder:"市"},null,8,["modelValue"])]),_:1}),l(F,{span:8},{default:t(()=>[l(m,{modelValue:o.district,"onUpdate:modelValue":e[9]||(e[9]=a=>o.district=a),placeholder:"区/县"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"详细地址",prop:"detail"},{default:t(()=>[l(m,{modelValue:o.detail,"onUpdate:modelValue":e[10]||(e[10]=a=>o.detail=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(ee,{modelValue:o.isDefault,"onUpdate:modelValue":e[11]||(e[11]=a=>o.isDefault=a)},{default:t(()=>[...e[24]||(e[24]=[p("设为默认",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),$e=te(Se,[["__scopeId","data-v-9790508e"]]);export{$e as default};
