import{d as z,r as I,s as D,o as M,c as p,a as r,w as n,b as m,q as O,E as u,u as R,f as t,h as i,j,i as x,F as C,t as l,k as w,e as c}from"./index-jh95nJwH.js";import{u as T}from"./user-TGyX2SHZ.js";import{g as G}from"./cart-BlZpDTBS.js";import{f as H}from"./order-3D-lLFhF.js";import{g as J}from"./address-BFdK1KhT.js";import{_ as K}from"./_plugin-vue_export-helper-BDJoutlP.js";const P={class:"checkout-page"},Q={class:"header-content"},W={class:"user-info"},X={class:"checkout-container"},Y={class:"address-section"},Z={key:0,class:"no-address"},ee={key:1,class:"address-list"},te={class:"address-info"},se={class:"address-name"},oe={class:"address-detail"},ne={class:"products-section"},re={class:"product-list"},le=["src","alt"],ae={class:"product-info"},de={class:"product-price"},ue={class:"product-subtotal"},ie={class:"order-summary"},ce={class:"summary-item"},pe={class:"summary-item total"},me={class:"submit-section"},ve=z({__name:"Checkout",setup(_e){const k=R(),A=O(),y=T(),v=I([]),_=I(null),f=I([]),h=I(!1),b=D(()=>f.value.reduce((o,e)=>o+e.product.price*e.quantity,0)),N=async()=>{try{const o=A.query.cartItemIds;if(!o){u.error("参数错误"),k.push("/cart");return}const d=(await G()).data||[],g=o.split(",").map(a=>parseInt(a));f.value=d.filter(a=>g.includes(a.id))}catch(o){console.error("加载购物车商品失败:",o),u.error("加载购物车商品失败")}},q=async()=>{try{const o=await J();if(v.value=o.data||[],v.value.length===0){u.warning("您还没有收货地址，请先添加地址");return}const e=v.value.find(d=>d.isDefault);_.value=e?e.id:v.value[0].id}catch(o){console.error("加载地址失败:",o),u.error("加载地址失败")}},V=()=>{k.push("/address")},F=async()=>{if(!_.value){u.warning("请选择收货地址");return}if(f.value.length===0){u.warning("请选择要购买的商品");return}h.value=!0;try{const o=f.value.map(a=>a.id),e=await H({addressId:_.value,cartItemIds:o});u.success("订单创建成功，请完成支付");const d=e.data&&e.data.orderNo||"",g=e.data&&e.data.totalAmount||b.value;k.push({path:"/payment",query:{orderNo:String(d),totalAmount:String(g)}})}catch(o){console.error("创建订单失败:",o),u.error("创建订单失败")}finally{h.value=!1}},S=()=>{y.logout(),u.success("退出成功"),k.push("/login")};return M(()=>{y.initUser(),N(),q()}),(o,e)=>{const d=m("el-menu-item"),g=m("el-menu"),a=m("el-button"),B=m("el-header"),L=m("el-empty"),$=m("el-radio"),E=m("el-radio-group"),U=m("el-main");return c(),p("div",P,[r(B,{class:"header"},{default:n(()=>[t("div",Q,[e[10]||(e[10]=t("div",{class:"logo"},[t("h2",null,"零食商城")],-1)),r(g,{mode:"horizontal",router:!0,class:"nav-menu"},{default:n(()=>[r(d,{index:"/"},{default:n(()=>[...e[3]||(e[3]=[i("首页",-1)])]),_:1}),r(d,{index:"/products"},{default:n(()=>[...e[4]||(e[4]=[i("商品列表",-1)])]),_:1}),r(d,{index:"/cart"},{default:n(()=>[...e[5]||(e[5]=[i("购物车",-1)])]),_:1}),r(d,{index:"/orders"},{default:n(()=>[...e[6]||(e[6]=[i("我的订单",-1)])]),_:1})]),_:1}),t("div",W,[x(y).isLoggedIn()?(c(),p(C,{key:0},[t("span",null,"欢迎，"+l(x(y).user?.nickname||x(y).user?.username),1),r(a,{onClick:e[0]||(e[0]=s=>o.$router.push("/account")),type:"text"},{default:n(()=>[...e[7]||(e[7]=[i("个人中心",-1)])]),_:1}),r(a,{onClick:S,type:"text"},{default:n(()=>[...e[8]||(e[8]=[i("退出",-1)])]),_:1})],64)):(c(),j(a,{key:1,onClick:e[1]||(e[1]=s=>o.$router.push("/login")),type:"primary"},{default:n(()=>[...e[9]||(e[9]=[i("登录",-1)])]),_:1}))])])]),_:1}),r(U,{class:"main-content"},{default:n(()=>[t("div",X,[e[18]||(e[18]=t("h2",null,"订单结算",-1)),t("div",Y,[e[12]||(e[12]=t("h3",null,"收货地址",-1)),v.value.length===0?(c(),p("div",Z,[r(L,{description:"暂无收货地址"},{default:n(()=>[r(a,{type:"primary",onClick:V},{default:n(()=>[...e[11]||(e[11]=[i("添加地址",-1)])]),_:1})]),_:1})])):(c(),p("div",ee,[r(E,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s)},{default:n(()=>[(c(!0),p(C,null,w(v.value,s=>(c(),p("div",{key:s.id,class:"address-item"},[r($,{label:s.id},{default:n(()=>[t("div",te,[t("div",se,l(s.receiverName)+" "+l(s.phone),1),t("div",oe,l(s.province)+" "+l(s.city)+" "+l(s.district)+" "+l(s.detail),1)])]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])]))]),t("div",ne,[e[13]||(e[13]=t("h3",null,"商品清单",-1)),t("div",re,[(c(!0),p(C,null,w(f.value,s=>(c(),p("div",{key:s.id,class:"product-item"},[t("img",{src:s.product.coverImage,alt:s.product.name,class:"product-image"},null,8,le),t("div",ae,[t("h4",null,l(s.product.name),1),t("p",null,l(s.product.subtitle),1),t("p",de,"¥"+l(s.product.price)+" × "+l(s.quantity),1)]),t("div",ue," ¥"+l((s.product.price*s.quantity).toFixed(2)),1)]))),128))])]),t("div",ie,[t("div",ce,[e[14]||(e[14]=t("span",null,"商品总价：",-1)),t("span",null,"¥"+l(b.value.toFixed(2)),1)]),e[16]||(e[16]=t("div",{class:"summary-item"},[t("span",null,"运费："),t("span",null,"¥0.00")],-1)),t("div",pe,[e[15]||(e[15]=t("span",null,"实付金额：",-1)),t("span",null,"¥"+l(b.value.toFixed(2)),1)])]),t("div",me,[r(a,{type:"primary",size:"large",disabled:!_.value||f.value.length===0,onClick:F,loading:h.value},{default:n(()=>[...e[17]||(e[17]=[i(" 提交订单 ",-1)])]),_:1},8,["disabled","loading"])])])]),_:1})])}}}),be=K(ve,[["__scopeId","data-v-885bb5ee"]]);export{be as default};
