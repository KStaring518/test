import{d as O,r as h,l as E,n as H,o as G,c as k,a as o,w as s,b as r,f as a,g as z,h as d,i as g,F as x,j as f,t as v,k as N,p as J,u as Q,E as W,q as X,e as u}from"./index-jh95nJwH.js";import{u as Y}from"./user-TGyX2SHZ.js";import{g as Z,a as ee}from"./product-DW7NrKLf.js";import{_ as te}from"./_plugin-vue_export-helper-BDJoutlP.js";const oe={class:"products-page"},se={class:"header-content"},ne={class:"user-info"},ae={class:"filter-section"},le={class:"products-grid"},re=["src","alt"],de={class:"product-info"},ue={class:"product-subtitle"},ie={class:"product-price"},pe={class:"product-stock"},ce={class:"pagination-section"},me=O({__name:"Products",setup(ge){const V=Q(),$=X(),p=Y(),I=h([]),w=h([]),c=E({categoryId:null,keyword:"",sort:""}),l=E({page:1,size:8,total:0}),B=async()=>{try{const n=await Z();I.value=n.data||[]}catch(n){console.error("加载分类失败:",n)}},C=async()=>{try{const n={page:l.page,size:l.size,...c},e=Object.fromEntries(Object.entries(n).filter(([U,m])=>m!=null&&m!=="")),i=await ee(e);w.value=i.data?.list||[],l.total=i.data?.total||0}catch(n){console.error("加载商品失败:",n)}},_=()=>{l.page=1,C()},L=()=>{c.categoryId=null,_()},M=n=>{l.size=n,l.page=1,C()},R=n=>{l.page=n,C()},j=n=>{V.push(`/product/${n}`)},D=()=>{p.logout(),W.success("退出成功"),V.push("/login")};return H(()=>$.query.categoryId,n=>{n&&(c.categoryId=parseInt(n),_())},{immediate:!0}),G(()=>{p.initUser(),B(),C()}),(n,e)=>{const i=r("el-menu-item"),U=r("el-menu"),m=r("el-button"),F=r("el-header"),y=r("el-option"),P=r("el-select"),b=r("el-col"),T=r("el-input"),S=r("el-row"),q=r("el-card"),A=r("el-pagination"),K=r("el-main");return u(),k("div",oe,[o(F,{class:"header"},{default:s(()=>[a("div",se,[e[17]||(e[17]=a("div",{class:"logo"},[a("h2",null,"零食商城")],-1)),o(U,{mode:"horizontal",router:!0,class:"nav-menu"},{default:s(()=>[o(i,{index:"/"},{default:s(()=>[...e[7]||(e[7]=[d("首页",-1)])]),_:1}),o(i,{index:"/products"},{default:s(()=>[...e[8]||(e[8]=[d("商品列表",-1)])]),_:1}),g(p).isLoggedIn()?(u(),k(x,{key:0},[o(i,{index:"/cart"},{default:s(()=>[...e[9]||(e[9]=[d("购物车",-1)])]),_:1}),o(i,{index:"/orders"},{default:s(()=>[...e[10]||(e[10]=[d("我的订单",-1)])]),_:1}),g(p).user?.role==="USER"?(u(),f(i,{key:0,index:"/merchant-register"},{default:s(()=>[...e[11]||(e[11]=[d(" 申请成为商家 ",-1)])]),_:1})):z("",!0),g(p).user?.role==="MERCHANT"?(u(),f(i,{key:1,index:"/merchant"},{default:s(()=>[...e[12]||(e[12]=[d(" 商家后台 ",-1)])]),_:1})):z("",!0),g(p).user?.role==="ADMIN"?(u(),f(i,{key:2,index:"/admin"},{default:s(()=>[...e[13]||(e[13]=[d(" 管理后台 ",-1)])]),_:1})):z("",!0)],64)):z("",!0)]),_:1}),a("div",ne,[g(p).isLoggedIn()?(u(),k(x,{key:0},[a("span",null,"欢迎，"+v(g(p).user?.nickname||g(p).user?.username),1),o(m,{onClick:e[0]||(e[0]=t=>n.$router.push("/account")),type:"text"},{default:s(()=>[...e[14]||(e[14]=[d("个人中心",-1)])]),_:1}),o(m,{onClick:D,type:"text"},{default:s(()=>[...e[15]||(e[15]=[d("退出",-1)])]),_:1})],64)):(u(),f(m,{key:1,onClick:e[1]||(e[1]=t=>n.$router.push("/login")),type:"primary"},{default:s(()=>[...e[16]||(e[16]=[d("登录",-1)])]),_:1}))])])]),_:1}),o(K,{class:"main-content"},{default:s(()=>[a("div",ae,[o(S,{gutter:20},{default:s(()=>[o(b,{span:6},{default:s(()=>[o(P,{modelValue:c.categoryId,"onUpdate:modelValue":e[2]||(e[2]=t=>c.categoryId=t),placeholder:"选择分类",clearable:"",onChange:_,onClear:L},{default:s(()=>[(u(!0),k(x,null,N(I.value,t=>(u(),f(y,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{span:6},{default:s(()=>[o(T,{modelValue:c.keyword,"onUpdate:modelValue":e[3]||(e[3]=t=>c.keyword=t),placeholder:"搜索商品",clearable:"",onKeyup:J(_,["enter"])},{append:s(()=>[o(m,{onClick:_},{default:s(()=>[...e[18]||(e[18]=[d("搜索",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(b,{span:6},{default:s(()=>[o(P,{modelValue:c.sort,"onUpdate:modelValue":e[4]||(e[4]=t=>c.sort=t),placeholder:"排序方式",onChange:_},{default:s(()=>[o(y,{label:"默认排序",value:""}),o(y,{label:"价格从低到高",value:"price_asc"}),o(y,{label:"价格从高到低",value:"price_desc"}),o(y,{label:"最新上架",value:"created_desc"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),a("div",le,[o(S,{gutter:20},{default:s(()=>[(u(!0),k(x,null,N(w.value,t=>(u(),f(b,{span:6,key:t.id},{default:s(()=>[o(q,{class:"product-card",onClick:_e=>j(t.id)},{default:s(()=>[a("img",{src:t.coverImage,alt:t.name,class:"product-image"},null,8,re),a("div",de,[a("h4",null,v(t.name),1),a("p",ue,v(t.subtitle),1),a("p",ie,"¥"+v(t.price),1),a("p",pe,"库存: "+v(t.stock),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),a("div",ce,[o(A,{"current-page":l.page,"onUpdate:currentPage":e[5]||(e[5]=t=>l.page=t),"page-size":l.size,"onUpdate:pageSize":e[6]||(e[6]=t=>l.size=t),total:l.total,"page-sizes":[8,16,24,32],layout:"total, prev, pager, next, sizes",background:"",onSizeChange:M,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Ce=te(me,[["__scopeId","data-v-3b806277"]]);export{Ce as default};
