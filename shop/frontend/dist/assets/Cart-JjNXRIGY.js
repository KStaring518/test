import{d as M,r as g,s as w,o as z,c as m,f as a,a as o,w as l,b as v,t as d,i as C,v as L,F as Q,k as j,E as i,h as c,u as D,e as _,x as I}from"./index-jh95nJwH.js";import{u as R}from"./user-TGyX2SHZ.js";import{g as G,u as H,r as J,c as K}from"./cart-BlZpDTBS.js";import{_ as O}from"./_plugin-vue_export-helper-BDJoutlP.js";const P={class:"cart-page"},W={class:"header"},X={class:"header-content"},Y={class:"nav"},Z={class:"user-info"},tt={class:"main-content"},et={class:"cart-container"},at={key:0,class:"empty-cart"},st={key:1,class:"cart-items"},ot={class:"cart-header"},nt={class:"cart-item-list"},lt={class:"item-product"},rt=["src","alt"],ct={class:"product-info"},dt={class:"item-price"},it={class:"item-quantity"},ut={class:"item-subtotal"},pt={class:"item-action"},mt={class:"cart-footer"},vt={class:"cart-summary"},_t={class:"total-amount"},ht={class:"cart-actions"},ft=M({__name:"Cart",setup(kt){const q=D(),h=R(),n=g([]),k=g(!1),x=g(!1),y=w(()=>n.value.filter(e=>e.checked).length),B=w(()=>n.value.filter(e=>e.checked).reduce((e,t)=>e+t.product.price*t.quantity,0)),f=async()=>{try{const e=await G();n.value=e.data,b()}catch(e){console.error("Failed to load cart:",e),i.error("加载购物车失败")}},b=()=>{const e=n.value.filter(t=>t.checked);k.value=e.length===n.value.length&&n.value.length>0,x.value=e.length>0&&e.length<n.value.length},F=e=>{n.value.forEach(t=>{t.checked=e}),b()},S=()=>{b()},U=async(e,t)=>{try{await H(e,t),i.success("数量更新成功")}catch(r){console.error("Failed to update quantity:",r),i.error("数量更新失败"),await f()}},E=async e=>{try{await I.confirm("确定要删除这个商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await J(e),i.success("删除成功"),await f()}catch(t){t!=="cancel"&&(console.error("Failed to remove item:",t),i.error("删除失败"))}},T=async()=>{try{await I.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await K(),i.success("购物车已清空"),await f()}catch(e){e!=="cancel"&&(console.error("Failed to clear cart:",e),i.error("清空失败"))}},A=async()=>{const e=n.value.filter(r=>r.checked);if(e.length===0){i.warning("请选择要结算的商品");return}const t=e.map(r=>r.id);q.push({path:"/checkout",query:{cartItemIds:t.join(",")}})};return z(()=>{h.initUser(),f()}),(e,t)=>{const r=v("router-link"),p=v("el-button"),N=v("el-empty"),V=v("el-checkbox"),$=v("el-input-number");return _(),m("div",P,[a("div",W,[a("div",X,[t[6]||(t[6]=a("div",{class:"logo"},"零食商城",-1)),a("div",Y,[o(r,{to:"/",class:"nav-link"},{default:l(()=>[...t[2]||(t[2]=[c("首页",-1)])]),_:1}),o(r,{to:"/products",class:"nav-link"},{default:l(()=>[...t[3]||(t[3]=[c("商品列表",-1)])]),_:1}),o(r,{to:"/orders",class:"nav-link"},{default:l(()=>[...t[4]||(t[4]=[c("我的订单",-1)])]),_:1})]),a("div",Z,[a("span",null,"欢迎, "+d(C(h).user?.nickname||C(h).user?.username),1),o(p,{type:"text",onClick:C(h).logout},{default:l(()=>[...t[5]||(t[5]=[c("退出",-1)])]),_:1},8,["onClick"])])])]),a("div",tt,[a("div",et,[t[12]||(t[12]=a("h2",null,"我的购物车",-1)),n.value.length===0?(_(),m("div",at,[o(N,{description:"购物车是空的"},{default:l(()=>[o(p,{type:"primary",onClick:t[0]||(t[0]=s=>e.$router.push("/products"))},{default:l(()=>[...t[7]||(t[7]=[c("去购物",-1)])]),_:1})]),_:1})])):(_(),m("div",st,[a("div",ot,[o(V,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onChange:F,indeterminate:x.value},{default:l(()=>[...t[8]||(t[8]=[c(" 全选 ",-1)])]),_:1},8,["modelValue","indeterminate"]),t[9]||(t[9]=L('<span class="header-product" data-v-b5bbdd11>商品信息</span><span class="header-price" data-v-b5bbdd11>单价</span><span class="header-quantity" data-v-b5bbdd11>数量</span><span class="header-subtotal" data-v-b5bbdd11>小计</span><span class="header-action" data-v-b5bbdd11>操作</span>',5))]),a("div",nt,[(_(!0),m(Q,null,j(n.value,s=>(_(),m("div",{key:s.id,class:"cart-item"},[o(V,{modelValue:s.checked,"onUpdate:modelValue":u=>s.checked=u,onChange:S},null,8,["modelValue","onUpdate:modelValue"]),a("div",lt,[a("img",{src:s.product.coverImage||"/placeholder.png",alt:s.product.name,class:"product-image"},null,8,rt),a("div",ct,[a("h4",null,d(s.product.name),1),a("p",null,d(s.product.subtitle),1)])]),a("div",dt,"¥"+d(s.product.price),1),a("div",it,[o($,{modelValue:s.quantity,"onUpdate:modelValue":u=>s.quantity=u,min:1,max:s.product.stock,size:"small",onChange:u=>U(s.id,u)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),a("div",ut,"¥"+d((s.product.price*s.quantity).toFixed(2)),1),a("div",pt,[o(p,{type:"danger",size:"small",onClick:u=>E(s.id)},{default:l(()=>[...t[10]||(t[10]=[c("删除",-1)])]),_:2},1032,["onClick"])])]))),128))]),a("div",mt,[a("div",vt,[a("span",null,"已选择 "+d(y.value)+" 件商品",1),a("span",_t,"合计: ¥"+d(B.value.toFixed(2)),1)]),a("div",ht,[o(p,{onClick:T},{default:l(()=>[...t[11]||(t[11]=[c("清空购物车",-1)])]),_:1}),o(p,{type:"primary",onClick:A,disabled:y.value===0},{default:l(()=>[c(" 结算 ("+d(y.value)+") ",1)]),_:1},8,["disabled"])])])]))])])])}}}),xt=O(ft,[["__scopeId","data-v-b5bbdd11"]]);export{xt as default};
