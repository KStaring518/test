import{G as c,r as l}from"./index-jh95nJwH.js";import{a}from"./_plugin-vue_export-helper-BDJoutlP.js";const u=o=>a.post("/auth/login",o),g=o=>(console.log("注册API调用，数据:",o),a.post("/auth/register",o)),h=c("user",()=>{const o=l(localStorage.getItem("token")||""),t=l(null);return{token:o,user:t,login:async r=>{try{const e=await u(r),{token:n,user:s}=e.data;return o.value=n,t.value=s,localStorage.setItem("token",n),s&&localStorage.setItem("user",JSON.stringify(s)),console.log("登录成功，用户信息:",s),e}catch(e){throw e}},register:async r=>{try{console.log("发送注册请求:",r);const e=await g(r);return console.log("注册API响应:",e),e}catch(e){throw console.error("注册API错误:",e),e}},logout:()=>{o.value="",t.value=null,localStorage.removeItem("token"),localStorage.removeItem("user")},isLoggedIn:()=>!!o.value&&!!t.value,getUserRole:()=>t.value?.role||null,initUser:()=>{const r=localStorage.getItem("token"),e=localStorage.getItem("user");if(r&&(o.value=r),e)try{t.value=JSON.parse(e)}catch{t.value=null}}}});export{h as u};
