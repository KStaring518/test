import{u as ae}from"./user-TGyX2SHZ.js";import{d as ne,r as _,o as ie,c as u,a as t,w as a,b as c,q as re,E as f,f as s,h as m,g as y,t as r,F as C,k as $,j as A,x as L,u as de,e as d}from"./index-jh95nJwH.js";import{d as ue,e as ce}from"./order-3D-lLFhF.js";import{k as me,s as ve}from"./merchant-BqVm6Od2.js";import{g as pe}from"./address-BFdK1KhT.js";import{_ as _e}from"./_plugin-vue_export-helper-BDJoutlP.js";const fe={class:"merchant-order-detail"},ke={class:"header-content"},ye={class:"order-detail-container"},ge={class:"back-section"},he={key:0,class:"loading-section"},be={key:1,class:"order-detail"},Ve={class:"order-header"},Ne={class:"order-basic-info"},Ae={class:"order-no"},we={class:"order-time"},Te={class:"order-status"},xe={class:"buyer-section"},De={class:"buyer-info"},Ie={class:"info-item"},Pe={class:"value"},Ce={class:"info-item"},$e={class:"value"},Se={class:"order-items-section"},Ue={key:0,class:"empty-items"},Me={key:1,class:"order-items"},Be={class:"item-image"},Ee=["src","alt"],Le={class:"item-info"},Oe={class:"item-price"},Fe={class:"item-total"},He={class:"delivery-section"},ze={class:"delivery-info"},Ye={class:"info-item"},qe={class:"value"},Re={class:"info-item"},je={class:"value"},Ge={class:"info-item"},Je={class:"value"},Ke={class:"amount-section"},Qe={class:"amount-info"},We={class:"amount-item"},Xe={class:"value"},Ze={class:"amount-item total"},es={class:"value"},ss={key:0,class:"logistics-section"},ts={class:"logistics-info"},ls={class:"info-item"},os={class:"value"},as={class:"info-item"},ns={class:"value"},is={class:"info-item"},rs={class:"value"},ds={key:0,class:"info-item"},us={class:"value"},cs={key:1,class:"info-item"},ms={class:"value"},vs={key:2,class:"info-item"},ps={class:"value"},_s={key:0,class:"logistics-tracks"},fs={class:"track-item"},ks={class:"track-location"},ys={class:"track-description"},gs={key:1,class:"ship-form-section"},hs={key:2,class:"remark-section"},bs={class:"remark-content"},Vs={class:"order-actions"},Ns={key:2,class:"error-section"},As=ne({__name:"MerchantOrderDetail",setup(ws){de();const O=re(),F=ae(),o=_(null),S=_(!0),w=_(!1),T=_([]),x=_([]),V=_(null),i=_({carrier:"",trackingNo:"",senderName:"",senderPhone:"",senderAddress:""}),D=async()=>{try{const n=parseInt(O.params.id),e=await ue(n);o.value=e.data,console.log("订单详情数据:",e.data),o.value.shipment&&await U(o.value.shipment.id)}catch(n){console.error("加载订单详情失败:",n),f.error("加载订单详情失败")}finally{S.value=!1}},H=async()=>{try{const{data:n}=await pe();x.value=n||[]}catch(n){console.error("加载地址簿失败",n)}},z=()=>{},Y=()=>{const n=x.value.find(e=>e.id===V.value);n&&(i.value.senderName=n.receiverName,i.value.senderPhone=n.phone,i.value.senderAddress=`${n.province} ${n.city} ${n.district} ${n.detail}`)},U=async n=>{try{const e=await ce(n);T.value=e.data,console.log("物流轨迹数据:",e.data)}catch(e){console.error("加载物流轨迹失败:",e),f.error("加载物流轨迹失败")}},b=_(!1),v=_({location:"",description:"",trackTime:""}),I=_(!1),q=()=>{v.value={location:"",description:"",trackTime:""},b.value=!0},R=async()=>{if(o.value?.shipment){if(!v.value.location||!v.value.description){f.warning("请填写位置和描述");return}I.value=!0;try{await me(o.value.shipment.id,{location:v.value.location,description:v.value.description,trackTime:v.value.trackTime||void 0}),f.success("已追加轨迹"),await U(o.value.shipment.id),b.value=!1}catch{f.error("追加失败")}finally{I.value=!1}}},j=async()=>{if(!o.value||!i.value.carrier||!i.value.trackingNo||!i.value.senderName||!i.value.senderAddress){f.warning("请填写完整的发货信息");return}try{await L.confirm("确定要发货这个订单吗？","确认发货",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w.value=!0,await ve(o.value.id,{carrier:i.value.carrier,trackingNo:i.value.trackingNo,senderName:i.value.senderName,senderPhone:i.value.senderPhone,senderAddress:i.value.senderAddress}),f.success("发货成功"),await D()}catch(n){n!=="cancel"&&(console.error("发货失败:",n),f.error("发货失败"))}finally{w.value=!1}},G=async()=>{if(o.value)try{await L.confirm("确定要关闭这个订单吗？","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.success("订单已关闭"),await D()}catch(n){n!=="cancel"&&(console.error("关闭订单失败:",n),f.error("关闭订单失败"))}},P=n=>new Date(n).toLocaleString("zh-CN"),J=n=>({UNPAID:"warning",PAID:"primary",SHIPPED:"success",FINISHED:"success",CLOSED:"info"})[n]||"info",K=n=>({UNPAID:"待付款",PAID:"待发货",SHIPPED:"已发货",FINISHED:"已完成",CLOSED:"已关闭"})[n]||n;return ie(()=>{F.initUser(),D(),H()}),(n,e)=>{const N=c("el-menu-item"),Q=c("el-menu"),W=c("el-header"),k=c("el-button"),X=c("el-skeleton"),Z=c("el-tag"),g=c("el-input"),p=c("el-form-item"),ee=c("el-date-picker"),M=c("el-form"),se=c("el-dialog"),B=c("el-empty"),te=c("el-timeline-item"),le=c("el-timeline"),h=c("el-option"),E=c("el-select"),oe=c("el-main");return d(),u("div",fe,[t(W,{class:"header"},{default:a(()=>[s("div",ke,[e[18]||(e[18]=s("div",{class:"logo"},[s("h2",null,"商家订单详情")],-1)),t(Q,{mode:"horizontal",router:!0,class:"nav-menu"},{default:a(()=>[t(N,{index:"/merchant"},{default:a(()=>[...e[14]||(e[14]=[m("首页",-1)])]),_:1}),t(N,{index:"/merchant/products"},{default:a(()=>[...e[15]||(e[15]=[m("商品管理",-1)])]),_:1}),t(N,{index:"/merchant/orders"},{default:a(()=>[...e[16]||(e[16]=[m("订单管理",-1)])]),_:1}),t(N,{index:"/merchant/categories"},{default:a(()=>[...e[17]||(e[17]=[m("分类管理",-1)])]),_:1})]),_:1})])]),_:1}),t(oe,{class:"main-content"},{default:a(()=>[s("div",ye,[s("div",ge,[t(k,{onClick:e[0]||(e[0]=l=>n.$router.push("/merchant/orders")),type:"text",icon:"ArrowLeft"},{default:a(()=>[...e[19]||(e[19]=[m(" 返回订单列表 ",-1)])]),_:1})]),S.value?(d(),u("div",he,[t(X,{rows:10,animated:""})])):o.value?(d(),u("div",be,[s("div",Ve,[s("div",Ne,[e[20]||(e[20]=s("h2",null,"订单详情",-1)),s("div",Ae,"订单号："+r(o.value.orderNo),1),s("div",we,"下单时间："+r(P(o.value.createdAt)),1)]),s("div",Te,[t(Z,{type:J(o.value.status),size:"large"},{default:a(()=>[m(r(K(o.value.status)),1)]),_:1},8,["type"])])]),t(se,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),title:"追加物流轨迹",width:"520px"},{footer:a(()=>[t(k,{onClick:e[4]||(e[4]=l=>b.value=!1)},{default:a(()=>[...e[21]||(e[21]=[m("取消",-1)])]),_:1}),t(k,{type:"primary",loading:I.value,onClick:R},{default:a(()=>[...e[22]||(e[22]=[m("提交",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(M,{"label-width":"90px"},{default:a(()=>[t(p,{label:"位置"},{default:a(()=>[t(g,{modelValue:v.value.location,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value.location=l),placeholder:"如：配送站、转运中心"},null,8,["modelValue"])]),_:1}),t(p,{label:"描述"},{default:a(()=>[t(g,{modelValue:v.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.description=l),type:"textarea",rows:3,placeholder:"轨迹说明"},null,8,["modelValue"])]),_:1}),t(p,{label:"时间"},{default:a(()=>[t(ee,{modelValue:v.value.trackTime,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.trackTime=l),type:"datetime","value-format":"YYYY-MM-DDTHH:mm:ss",placeholder:"不填默认当前时间"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s("div",xe,[e[25]||(e[25]=s("h3",null,"买家信息",-1)),s("div",De,[s("div",Ie,[e[23]||(e[23]=s("span",{class:"label"},"买家ID：",-1)),s("span",Pe,r(o.value.userId),1)]),s("div",Ce,[e[24]||(e[24]=s("span",{class:"label"},"联系电话：",-1)),s("span",$e,r(o.value.receiverPhone),1)])])]),s("div",Se,[e[26]||(e[26]=s("h3",null,"商品信息",-1)),!o.value.orderItems||o.value.orderItems.length===0?(d(),u("div",Ue,[t(B,{description:"暂无商品信息"})])):(d(),u("div",Me,[(d(!0),u(C,null,$(o.value.orderItems,l=>(d(),u("div",{key:l.id,class:"order-item"},[s("div",Be,[s("img",{src:l.product?.coverImage||"/placeholder.png",alt:l.productNameSnapshot},null,8,Ee)]),s("div",Le,[s("h4",null,r(l.productNameSnapshot),1),s("p",Oe,"¥"+r(l.priceSnapshot)+" × "+r(l.quantity),1)]),s("div",Fe," ¥"+r(l.subtotal),1)]))),128))]))]),s("div",He,[e[30]||(e[30]=s("h3",null,"收货信息",-1)),s("div",ze,[s("div",Ye,[e[27]||(e[27]=s("span",{class:"label"},"收货人：",-1)),s("span",qe,r(o.value.receiverName),1)]),s("div",Re,[e[28]||(e[28]=s("span",{class:"label"},"联系电话：",-1)),s("span",je,r(o.value.receiverPhone),1)]),s("div",Ge,[e[29]||(e[29]=s("span",{class:"label"},"收货地址：",-1)),s("span",Je,r(o.value.receiverAddress),1)])])]),s("div",Ke,[e[33]||(e[33]=s("h3",null,"订单金额",-1)),s("div",Qe,[s("div",We,[e[31]||(e[31]=s("span",{class:"label"},"商品总额：",-1)),s("span",Xe,"¥"+r(o.value.totalAmount),1)]),s("div",Ze,[e[32]||(e[32]=s("span",{class:"label"},"实付金额：",-1)),s("span",es,"¥"+r(o.value.totalAmount),1)])])]),o.value.shipment?(d(),u("div",ss,[e[42]||(e[42]=s("h3",null,"物流信息",-1)),s("div",ts,[s("div",ls,[e[34]||(e[34]=s("span",{class:"label"},"物流公司：",-1)),s("span",os,r(o.value.shipment.carrier),1)]),s("div",as,[e[35]||(e[35]=s("span",{class:"label"},"物流单号：",-1)),s("span",ns,r(o.value.shipment.trackingNo),1)]),s("div",is,[e[36]||(e[36]=s("span",{class:"label"},"发货时间：",-1)),s("span",rs,r(P(o.value.shipment.shippedAt)),1)]),o.value.shipment.senderName?(d(),u("div",ds,[e[37]||(e[37]=s("span",{class:"label"},"发货人：",-1)),s("span",us,r(o.value.shipment.senderName),1)])):y("",!0),o.value.shipment.senderPhone?(d(),u("div",cs,[e[38]||(e[38]=s("span",{class:"label"},"联系电话：",-1)),s("span",ms,r(o.value.shipment.senderPhone),1)])):y("",!0),o.value.shipment.shippingAddress?(d(),u("div",vs,[e[39]||(e[39]=s("span",{class:"label"},"发货地址：",-1)),s("span",ps,r(o.value.shipment.shippingAddress),1)])):y("",!0)]),T.value.length>0?(d(),u("div",_s,[e[41]||(e[41]=s("h4",null,"物流轨迹",-1)),t(le,null,{default:a(()=>[(d(!0),u(C,null,$(T.value,l=>(d(),A(te,{key:l.id,timestamp:P(l.trackTime),placement:"top"},{default:a(()=>[s("div",fs,[s("div",ks,r(l.location),1),s("div",ys,r(l.description),1)])]),_:2},1032,["timestamp"]))),128))]),_:1}),t(k,{type:"primary",onClick:q,style:{"margin-top":"10px"}},{default:a(()=>[...e[40]||(e[40]=[m("追加轨迹",-1)])]),_:1})])):y("",!0)])):y("",!0),o.value.status==="PAID"&&!o.value.shipment?(d(),u("div",gs,[e[45]||(e[45]=s("h3",null,"发货信息",-1)),t(M,{model:i.value,"label-width":"100px",style:{"max-width":"520px"}},{default:a(()=>[t(p,{label:"地址簿"},{default:a(()=>[t(E,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l),placeholder:"从地址簿选择发货地址",onChange:z},{default:a(()=>[(d(!0),u(C,null,$(x.value,l=>(d(),A(h,{key:l.id,label:`${l.receiverName} ${l.phone} | ${l.province} ${l.city} ${l.district} ${l.detail}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V.value?(d(),A(k,{key:0,style:{"margin-left":"8px"},onClick:Y},{default:a(()=>[...e[43]||(e[43]=[m("一键填充",-1)])]),_:1})):y("",!0)]),_:1}),t(p,{label:"发货人"},{default:a(()=>[t(g,{modelValue:i.value.senderName,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.senderName=l),placeholder:"请输入发货人姓名"},null,8,["modelValue"])]),_:1}),t(p,{label:"联系电话"},{default:a(()=>[t(g,{modelValue:i.value.senderPhone,"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.senderPhone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(p,{label:"发货地址"},{default:a(()=>[t(g,{modelValue:i.value.senderAddress,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.senderAddress=l),placeholder:"请输入发货地址（省市区+详细）"},null,8,["modelValue"])]),_:1}),t(p,{label:"物流公司"},{default:a(()=>[t(E,{modelValue:i.value.carrier,"onUpdate:modelValue":e[10]||(e[10]=l=>i.value.carrier=l),placeholder:"请选择物流公司"},{default:a(()=>[t(h,{label:"顺丰速运",value:"顺丰速运"}),t(h,{label:"中通快递",value:"中通快递"}),t(h,{label:"圆通速递",value:"圆通速递"}),t(h,{label:"申通快递",value:"申通快递"}),t(h,{label:"京东物流",value:"京东物流"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"运单号"},{default:a(()=>[t(g,{modelValue:i.value.trackingNo,"onUpdate:modelValue":e[11]||(e[11]=l=>i.value.trackingNo=l),placeholder:"请输入快递单号"},null,8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(k,{type:"primary",loading:w.value,onClick:j},{default:a(()=>[...e[44]||(e[44]=[m("确认发货",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):y("",!0),o.value.remark?(d(),u("div",hs,[e[46]||(e[46]=s("h3",null,"订单备注",-1)),s("div",bs,r(o.value.remark),1)])):y("",!0),s("div",Vs,[o.value.status==="UNPAID"?(d(),A(k,{key:0,type:"danger",size:"large",onClick:G},{default:a(()=>[...e[47]||(e[47]=[m(" 关闭订单 ",-1)])]),_:1})):y("",!0),t(k,{type:"info",size:"large",onClick:e[12]||(e[12]=l=>n.$router.push("/merchant/orders"))},{default:a(()=>[...e[48]||(e[48]=[m(" 返回列表 ",-1)])]),_:1})])])):(d(),u("div",Ns,[t(B,{description:"订单不存在或已被删除"},{default:a(()=>[t(k,{type:"primary",onClick:e[13]||(e[13]=l=>n.$router.push("/merchant/orders"))},{default:a(()=>[...e[49]||(e[49]=[m("返回订单列表",-1)])]),_:1})]),_:1})]))])]),_:1})])}}}),$s=_e(As,[["__scopeId","data-v-bc44fcbf"]]);export{$s as default};
