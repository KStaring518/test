# 零食商城系统 Postman 测试指南

## 📋 测试概述

本指南将帮助你使用 Postman 全面测试零食商城系统的所有功能。系统包含用户管理、商品管理、购物车、订单、支付、评价、智能客服等核心功能。

## 🚀 快速开始

### 1. 环境准备

#### 启动后端服务
```bash
# 在项目根目录执行
mvn spring-boot:run
# 或
java -jar target/shop-system-0.0.1-SNAPSHOT.jar
```

#### 启动前端服务
```bash
# 在 frontend 目录执行
npm run dev
```

#### 启动智能客服（可选）
```bash
# 确保 Ollama 已安装并运行
ollama serve
ollama pull qwen2.5:7b
```

### 2. Postman 环境配置

#### 导入环境变量
1. 在 Postman 中创建新环境
2. 添加以下变量：

| 变量名 | 初始值 | 描述 |
|--------|--------|------|
| `base_url` | `http://localhost:8080/api` | API 基础地址 |
| `admin_username` | `admin` | 管理员用户名 |
| `admin_password` | `123456` | 管理员密码 |
| `merchant_username` | `merchant` | 商家用户名 |
| `merchant_password` | `123456` | 商家密码 |
| `user_username` | `testuser` | 测试用户用户名 |
| `user_password` | `123456` | 测试用户密码 |
| `token_admin` | `` | 管理员 Token（自动设置） |
| `token_merchant` | `` | 商家 Token（自动设置） |
| `token_user` | `` | 用户 Token（自动设置） |

#### 导入测试集合
1. 导入 `Postman_Test_Collection.json` 文件
2. 选择对应的环境
3. 开始测试

## 🧪 测试流程

### 阶段 1: 系统健康检查
**目标**: 验证系统基本功能正常

1. **检查系统状态** - 获取商品列表
   - 验证 API 可访问
   - 检查返回数据格式

2. **获取轮播图** - 验证首页轮播功能
   - 检查轮播图数据
   - 验证图片链接

3. **获取分类树** - 验证商品分类功能
   - 检查分类层级结构
   - 验证分类数据完整性

### 阶段 2: 用户认证测试
**目标**: 验证用户登录注册功能

1. **管理员登录**
   - 使用 admin/123456 登录
   - 验证 Token 自动保存

2. **商家登录**
   - 使用 merchant/123456 登录
   - 验证商家权限

3. **普通用户登录**
   - 使用 testuser/123456 登录
   - 验证用户权限

4. **用户注册**
   - 创建新用户账号
   - 验证注册流程

### 阶段 3: 商品管理测试
**目标**: 验证商品相关功能

1. **商品浏览**
   - 获取商品列表
   - 按分类筛选
   - 关键词搜索
   - 价格排序

2. **商品详情**
   - 查看商品详细信息
   - 验证商品数据完整性

3. **商家商品管理**
   - 创建新商品
   - 管理商品列表
   - 更新商品信息

### 阶段 4: 购物车测试
**目标**: 验证购物车功能

1. **添加商品**
   - 添加商品到购物车
   - 验证库存检查

2. **购物车管理**
   - 查看购物车列表
   - 更新商品数量
   - 切换选择状态
   - 删除商品

### 阶段 5: 地址管理测试
**目标**: 验证收货地址功能

1. **地址操作**
   - 添加收货地址
   - 查看地址列表
   - 更新地址信息
   - 删除地址

2. **默认地址**
   - 设置默认地址
   - 验证默认地址逻辑

### 阶段 6: 订单管理测试
**目标**: 验证订单流程

1. **创建订单**
   - 从购物车创建订单
   - 验证订单数据

2. **订单管理**
   - 查看订单列表
   - 查看订单详情
   - 取消订单

### 阶段 7: 支付测试
**目标**: 验证支付功能

1. **创建支付**
   - 创建支付宝支付订单
   - 验证支付参数

2. **模拟支付**
   - 使用模拟支付功能
   - 验证支付状态更新

### 阶段 8: 评价系统测试
**目标**: 验证商品评价功能

1. **添加评价**
   - 为商品添加评价
   - 上传评价图片

2. **查看评价**
   - 查看商品评价列表
   - 验证评价数据

### 阶段 9: 管理员功能测试
**目标**: 验证管理员权限功能

1. **用户管理**
   - 查看用户列表
   - 管理用户信息

2. **订单管理**
   - 查看所有订单
   - 管理订单状态

3. **内容管理**
   - 创建轮播图
   - 管理系统内容

### 阶段 10: 智能客服测试
**目标**: 验证客服功能

1. **发送消息**
   - 发送客服消息
   - 验证 AI 回复

2. **聊天历史**
   - 查看聊天记录
   - 验证消息存储

## 🔍 测试检查点

### 响应状态码检查
- ✅ 200: 请求成功
- ✅ 201: 创建成功
- ✅ 400: 请求参数错误
- ✅ 401: 未授权
- ✅ 403: 权限不足
- ✅ 404: 资源不存在
- ✅ 500: 服务器错误

### 数据格式检查
- ✅ JSON 格式正确
- ✅ 字段类型匹配
- ✅ 必填字段完整
- ✅ 数据范围合理

### 业务逻辑检查
- ✅ 权限控制正确
- ✅ 数据关联正确
- ✅ 状态流转正确
- ✅ 业务规则符合

## 🐛 常见问题排查

### 1. 认证问题
**问题**: 401 Unauthorized
**解决**: 
- 检查 Token 是否正确设置
- 确认用户角色权限
- 验证 Token 是否过期

### 2. 数据问题
**问题**: 404 Not Found
**解决**:
- 检查资源 ID 是否存在
- 确认数据是否已创建
- 验证关联关系

### 3. 权限问题
**问题**: 403 Forbidden
**解决**:
- 检查用户角色
- 确认操作权限
- 验证资源所有权

### 4. 参数问题
**问题**: 400 Bad Request
**解决**:
- 检查请求参数格式
- 确认必填字段
- 验证参数类型

## 📊 测试报告模板

### 测试结果统计
- 总测试用例数: 50+
- 通过用例数: ___
- 失败用例数: ___
- 通过率: ___%

### 功能模块测试结果
| 模块 | 状态 | 备注 |
|------|------|------|
| 系统健康检查 | ✅/❌ | |
| 用户认证 | ✅/❌ | |
| 商品管理 | ✅/❌ | |
| 购物车 | ✅/❌ | |
| 地址管理 | ✅/❌ | |
| 订单管理 | ✅/❌ | |
| 支付系统 | ✅/❌ | |
| 评价系统 | ✅/❌ | |
| 管理员功能 | ✅/❌ | |
| 智能客服 | ✅/❌ | |

### 问题汇总
1. **严重问题**: 
2. **一般问题**: 
3. **建议改进**: 

## 🎯 自动化测试建议

### 使用 Newman 运行自动化测试
```bash
# 安装 Newman
npm install -g newman

# 运行测试集合
newman run Postman_Test_Collection.json -e environment.json

# 生成测试报告
newman run Postman_Test_Collection.json -e environment.json -r html --reporter-html-export report.html
```

### 集成到 CI/CD
```yaml
# GitHub Actions 示例
- name: Run API Tests
  run: |
    newman run Postman_Test_Collection.json -e environment.json
```

## 📝 测试注意事项

1. **测试顺序**: 按照依赖关系执行测试
2. **数据清理**: 测试后清理测试数据
3. **环境隔离**: 使用独立的测试环境
4. **数据备份**: 测试前备份重要数据
5. **日志记录**: 记录详细的测试日志

## 🔧 高级测试技巧

### 1. 使用 Pre-request Scripts
```javascript
// 自动生成测试数据
pm.environment.set("randomEmail", "test" + Date.now() + "@example.com");
```

### 2. 使用 Test Scripts
```javascript
// 自动验证响应
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response has required fields", function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('data');
});
```

### 3. 使用环境变量
```javascript
// 动态设置变量
pm.environment.set("userId", pm.response.json().data.id);
```

## 📞 技术支持

如果在测试过程中遇到问题，请：

1. 检查系统日志
2. 验证数据库状态
3. 确认服务运行状态
4. 查看 API 文档
5. 联系开发团队

---

**祝测试顺利！** 🎉
