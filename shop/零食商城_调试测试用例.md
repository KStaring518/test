# 零食商城调试测试用例

## 问题分析

你遇到的创建订单400错误，可能的原因有：

### 1. 缺少必要参数
创建订单需要以下参数：
- `addressId`: 收货地址ID
- `cartItemIds`: 购物车商品ID列表
- `remark`: 备注（可选）

### 2. 环境变量未设置
确保以下环境变量已正确设置：
- `test_address_id`: 测试地址ID
- `test_cart_item_id`: 测试购物车项ID

## 调试步骤

### 步骤1：检查环境变量
在Postman中执行以下测试，检查环境变量是否正确设置：

```javascript
// 在Test脚本中添加
console.log('test_address_id:', pm.environment.get('test_address_id'));
console.log('test_cart_item_id:', pm.environment.get('test_cart_item_id'));
```

### 步骤2：检查购物车是否有商品
在创建订单前，先执行"获取购物车列表"测试，确保购物车中有商品。

### 步骤3：检查地址是否存在
在创建订单前，先执行"获取地址列表"测试，确保有可用的地址。

### 步骤4：使用正确的请求体
创建订单的请求体应该是：

```json
{
  "addressId": 1,
  "cartItemIds": [1],
  "remark": "请尽快发货"
}
```

## 修复后的测试流程

### 1. 用户登录
```http
POST {{base_url}}/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456"
}
```

### 2. 添加商品到购物车
```http
POST {{base_url}}/cart/add
Authorization: Bearer {{token_user}}
Content-Type: application/json

{
  "productId": 1,
  "quantity": 2
}
```

### 3. 获取购物车列表
```http
GET {{base_url}}/cart/list
Authorization: Bearer {{token_user}}
```

### 4. 添加收货地址
```http
POST {{base_url}}/address/create
Authorization: Bearer {{token_user}}
Content-Type: application/json

{
  "receiverName": "张三",
  "phone": "13800138000",
  "province": "广东省",
  "city": "深圳市",
  "district": "南山区",
  "detail": "科技园南区深南大道10000号",
  "isDefault": true
}
```

### 5. 创建订单
```http
POST {{base_url}}/order/create
Authorization: Bearer {{token_user}}
Content-Type: application/json

{
  "addressId": {{test_address_id}},
  "cartItemIds": [{{test_cart_item_id}}],
  "remark": "请尽快发货"
}
```

## 常见错误及解决方案

### 错误1：400 Bad Request
**原因**: 请求参数不正确
**解决**: 检查请求体格式和参数名称

### 错误2：购物车为空
**原因**: 购物车中没有商品
**解决**: 先添加商品到购物车

### 错误3：地址不存在
**原因**: 没有可用的收货地址
**解决**: 先创建收货地址

### 错误4：商品库存不足
**原因**: 商品库存不够
**解决**: 检查商品库存或减少购买数量

## 调试技巧

1. **查看响应体**: 400错误通常会在响应体中包含具体错误信息
2. **检查控制台**: 查看Postman控制台的日志输出
3. **验证环境变量**: 确保所有必要的环境变量都已设置
4. **按顺序执行**: 按照正确的顺序执行测试用例

## 建议

1. 使用修复后的测试集合
2. 按照正确的顺序执行测试
3. 检查每个步骤的响应
4. 确保环境变量正确设置
